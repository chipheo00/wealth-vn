"use strict";(self.webpackChunkwealthvn_docs=self.webpackChunkwealthvn_docs||[]).push([[7928],{3552(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>i});const l=JSON.parse('{"id":"development/goals/goal-page-logic","title":"Goal Page Business Logic","description":"This document describes the business logic, formulas, and component interactions","source":"@site/docs/development/goals/Goal-page-logic.md","sourceDirName":"development/goals","slug":"/development/goals/goal-page-logic","permalink":"/wealth-vn/docs/development/goals/goal-page-logic","draft":false,"unlisted":false,"editUrl":"https://github.com/chipheo00/vn-wealthfolio/tree/main/docs/docs/development/goals/Goal-page-logic.md","tags":[],"version":"current","frontMatter":{"id":"goal-page-logic","title":"Goal Page Business Logic","sidebar_label":"Goals Logic"},"sidebar":"tutorialSidebar","previous":{"title":"Activity Types","permalink":"/wealth-vn/docs/development/activities/activity-types"},"next":{"title":"Goal Allocation Setting Plan","permalink":"/wealth-vn/docs/development/goals/allocation-setting-plan"}}');var a=t(6070),s=t(8193);const r={id:"goal-page-logic",title:"Goal Page Business Logic",sidebar_label:"Goals Logic"},o="Goal Page Business Logic",c={},i=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"Overview",id:"overview",level:2},{value:"User Flows",id:"user-flows",level:2},{value:"1. Create New Goal",id:"1-create-new-goal",level:3},{value:"2. Manage Allocations",id:"2-manage-allocations",level:3},{value:"3. Track Progress (Auto)",id:"3-track-progress-auto",level:3},{value:"File Structure",id:"file-structure",level:3},{value:"Core Data Types",id:"core-data-types",level:2},{value:"Goal Interface",id:"goal-interface",level:3},{value:"GoalAllocation Interface",id:"goalallocation-interface",level:3},{value:"GoalProgress Interface (Internal)",id:"goalprogress-interface-internal",level:3},{value:"Goals Page",id:"goals-page",level:2},{value:"Data Flow",id:"data-flow",level:3},{value:"Key Implementation",id:"key-implementation",level:3},{value:"Display Elements",id:"display-elements",level:3},{value:"GoalItem Component",id:"goalitem-component",level:2},{value:"Props",id:"props",level:3},{value:"Display Elements",id:"display-elements-1",level:3},{value:"Allocation Badge Calculation",id:"allocation-badge-calculation",level:3},{value:"Status Logic",id:"status-logic",level:3},{value:"Track Status Logic",id:"track-status-logic",level:3},{value:"Progress Bar Color",id:"progress-bar-color",level:3},{value:"Goal Allocations Table",id:"goal-allocations-table",level:2},{value:"Structure",id:"structure",level:3},{value:"Props",id:"props-1",level:3},{value:"Unallocated Row Calculation",id:"unallocated-row-calculation",level:3},{value:"Table Display Per Goal Row",id:"table-display-per-goal-row",level:3},{value:"Validation",id:"validation",level:3},{value:"Goal Form",id:"goal-form",level:2},{value:"Form Fields",id:"form-fields",level:3},{value:"Auto-Calculate Monthly Investment",id:"auto-calculate-monthly-investment",level:3},{value:"Key Formulas",id:"key-formulas",level:2},{value:"1. Current Value (Contributed Value)",id:"1-current-value-contributed-value",level:3},{value:"2. Progress Percentage",id:"2-progress-percentage",level:3},{value:"3. Projected Value (for On-Track Determination)",id:"3-projected-value-for-on-track-determination",level:3},{value:"4. On-Track Determination",id:"4-on-track-determination",level:3},{value:"5. Months From Start Calculation",id:"5-months-from-start-calculation",level:3},{value:"Business Rules",id:"business-rules",level:2},{value:"Allocation Rules",id:"allocation-rules",level:3},{value:"Goal Status Rules",id:"goal-status-rules",level:3},{value:"Track Status Rules",id:"track-status-rules",level:3},{value:"Data Source Rules",id:"data-source-rules",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"goal-page-business-logic",children:"Goal Page Business Logic"})}),"\n",(0,a.jsx)(n.p,{children:"This document describes the business logic, formulas, and component interactions\nfor the Goals feature in WealthVN."}),"\n",(0,a.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#overview",children:"Overview"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#user-flows",children:"User Flows"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#core-data-types",children:"Core Data Types"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsxs)(n.a,{href:"#goals-page",children:["Goals Page (",(0,a.jsx)(n.code,{children:"goals-page.tsx"}),")"]})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#goalitem-component",children:"GoalItem Component"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#goal-allocations-table",children:"Goal Allocations Table"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#goal-form",children:"Goal Form (Add/Edit)"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#key-formulas",children:"Key Formulas"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"#business-rules",children:"Business Rules"})}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"The Goals feature allows users to:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Create financial goals with target amounts and timelines"}),"\n",(0,a.jsx)(n.li,{children:"Allocate portions of their investment accounts toward specific goals"}),"\n",(0,a.jsx)(n.li,{children:"Track progress through contributed value calculations"}),"\n",(0,a.jsx)(n.li,{children:"Monitor if they're on/off track based on projected vs actual values"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"user-flows",children:"User Flows"}),"\n",(0,a.jsx)(n.h3,{id:"1-create-new-goal",children:"1. Create New Goal"}),"\n",(0,a.jsx)(n.mermaid,{value:"graph TD\n    A[User] --\x3e|Click 'Add Goal'| B(Goal Form Modal)\n    B --\x3e|Enter| C[Title, Target Amount]\n    B --\x3e|Optional| D[Start Date, Due Date, Target Return %]\n    C & D --\x3e E{All Data Present?}\n    E --\x3e|Yes| F[Auto-calculate Monthly Investment]\n    E --\x3e|No| G[Wait for Input]\n    F --\x3e H[User Submits]\n    H --\x3e I[Validate Inputs]\n    I --\x3e|Success| J[Create Goal in DB]\n    I --\x3e|Error| B\n    J --\x3e K[Refresh Goal List]"}),"\n",(0,a.jsx)(n.h3,{id:"2-manage-allocations",children:"2. Manage Allocations"}),"\n",(0,a.jsx)(n.p,{children:"This flow describes how users assign account funds to goals."}),"\n",(0,a.jsx)(n.mermaid,{value:"graph TD\n    A[User] --\x3e|Open| B[Goal Details Page]\n    B --\x3e|Click| C[Edit Allocations]\n    C --\x3e D[Modal: List all Accounts]\n    D --\x3e E{User Action}\n    E --\x3e|Input %| F[Calculate Current Amount]\n    E --\x3e|Input Amount| G[Calculate % based on Account Value]\n    F & G --\x3e H[Update Remaining Balance Display]\n    H --\x3e I{Total > 100%?}\n    I --\x3e|Yes| J[Show Error / Disable Submit]\n    I --\x3e|No| K[Enable Submit]\n    K --\x3e|Submit| L[Update Allocations in DB]\n    L --\x3e M[Recalculate Goal Progress]"}),"\n",(0,a.jsx)(n.h3,{id:"3-track-progress-auto",children:"3. Track Progress (Auto)"}),"\n",(0,a.jsx)(n.p,{children:'How the system determines if a goal is "On Track".'}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant U as User Display\n    participant H as Hooks (useGoalProgress)\n    participant S as Store/DB\n\n    U->>H: Request Goal Data\n    H->>S: Fetch Goal & Allocations\n    H->>S: Fetch Latest Account Valuations\n    S--\x3e>H: Return Data\n\n    rect rgb(200, 240, 200)\n        Note over H: Calculation Step\n        H->>H: Sum Contributed Values (Current Value)\n        H->>H: Calculate Projected Value (Compound Interest)\n        H->>H: Compare Current vs Projected\n    end\n\n    H--\x3e>U: Return { progress, isOnTrack, status }\n    U->>U: Render Progress Bar & Status Badge"}),"\n",(0,a.jsx)(n.h3,{id:"file-structure",children:"File Structure"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Component"}),(0,a.jsx)(n.th,{children:"Location"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Goals Page"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/pages/goals/goals-page.tsx"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Goal Details Page"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/pages/goals/goal-details-page.tsx"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"GoalItem"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/pages/goals/components/goal-item.tsx"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"GoalAllocations"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/pages/goals/components/goal-allocations.tsx"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"GoalForm"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/pages/goals/components/goal-form.tsx"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"useGoalProgress Hook"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/pages/goals/use-goal-progress.ts"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Goal Utils"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/pages/goals/lib/goal-utils.ts"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Goal Commands"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"src/commands/goal.ts"})})]})]})]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"core-data-types",children:"Core Data Types"}),"\n",(0,a.jsx)(n.h3,{id:"goal-interface",children:"Goal Interface"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface Goal {\n  id: string;\n  title: string;\n  description?: string;\n  targetAmount: number; // The target value to reach\n  targetReturnRate?: number; // Expected annual return rate (0-100%)\n  isAchieved?: boolean; // Manually marked as complete\n  dueDate?: string; // ISO date string - when goal should be achieved\n  monthlyInvestment?: number; // Monthly DCA contribution amount\n  startDate?: string; // ISO date string - when goal tracking begins\n  allocations?: GoalAllocation[];\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"goalallocation-interface",children:"GoalAllocation Interface"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface GoalAllocation {\n  id: string;\n  goalId: string;\n  accountId: string;\n  initialContribution: number; // Locked initial amount at allocation start\n  allocatedPercent: number; // Percentage of account GROWTH attributed to goal (0-100)\n  allocationDate?: string; // YYYY-MM-DD format - when allocation becomes active\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"goalprogress-interface-internal",children:"GoalProgress Interface (Internal)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface GoalProgress {\n  goalId: string;\n  currentValue: number; // Current contributed value\n  targetAmount: number; // Target from goal\n  progress: number; // Percentage (0-100)\n  expectedProgress: number; // Timeline-based expectation\n  isOnTrack: boolean; // currentValue >= projectedValue\n  projectedValue: number; // Expected value at today based on plan\n}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"goals-page",children:"Goals Page"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"File:"})," ",(0,a.jsx)(n.code,{children:"src/pages/goals/goals-page.tsx"})]}),"\n",(0,a.jsx)(n.h3,{id:"data-flow",children:"Data Flow"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Fetch Goals"})," - Query all goals from backend"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Fetch Allocations"})," - Query all goal allocations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Fetch Latest Valuations"})," - Get current account values (NOT\naccount.balance)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Calculate Progress"})," - Use ",(0,a.jsx)(n.code,{children:"useGoalProgress"})," hook to compute each goal's\nprogress"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"key-implementation",children:"Key Implementation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// Get latest account valuations (source of truth for account values)\nconst { latestValuations } = useLatestValuations(accountIds);\n\n// Build current account values map\nconst currentAccountValuesFromValuations = new Map(\n  (latestValuations || []).map((val) => [val.accountId, val.totalValue]),\n);\n\n// Calculate progress for each goal\nconst { getGoalProgress } = useGoalProgress(goals);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"display-elements",children:"Display Elements"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Goal Cards Grid"})," - 3-column responsive grid of GoalItem components"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Allocations Table"})," - Read-only matrix showing all goal-account allocations"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Empty State"})," - Placeholder when no goals exist"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"goalitem-component",children:"GoalItem Component"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"File:"})," ",(0,a.jsx)(n.code,{children:"src/pages/goals/components/goal-item.tsx"})]}),"\n",(0,a.jsx)(n.h3,{id:"props",children:"Props"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface GoalItemProps {\n  goal: Goal;\n  currentValue?: number; // Calculated contributed value from allocations\n  progress?: number; // Percentage (0-100)\n  isOnTrack?: boolean; // Actual >= Projected\n  allocations?: GoalAllocation[]; // Allocations for this specific goal\n  totalAccountCount?: number; // Total number of accounts in portfolio\n  onEdit: (goal: Goal) => void;\n  onDelete: (goal: Goal) => void;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"display-elements-1",children:"Display Elements"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Element"}),(0,a.jsx)(n.th,{children:"Source"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Title"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"goal.title"})}),(0,a.jsx)(n.td,{children:"Goal name"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Status Badge"})}),(0,a.jsx)(n.td,{children:"Computed"}),(0,a.jsx)(n.td,{children:"Completed/Not Started/Overdue/Ongoing"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Allocation Badge"})}),(0,a.jsx)(n.td,{children:"Computed"}),(0,a.jsx)(n.td,{children:"Average allocation percentage across accounts"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Current Value"})}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"currentValue"})," prop"]}),(0,a.jsx)(n.td,{children:"Formatted currency value"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Target Value"})}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"goal.targetAmount"})}),(0,a.jsx)(n.td,{children:"Formatted currency value"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Progress Bar"})}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"progress"})," prop"]}),(0,a.jsx)(n.td,{children:"Visual percentage with color based on track status"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Track Status"})}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"isOnTrack"})," prop"]}),(0,a.jsx)(n.td,{children:'"On Track" / "Off Track" / "Done"'})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"allocation-badge-calculation",children:"Allocation Badge Calculation"}),"\n",(0,a.jsxs)(n.p,{children:["The allocation badge shows the ",(0,a.jsx)(n.strong,{children:"average allocation percentage"})," across all\naccounts:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// Number of accounts allocated to this goal\nconst allocationCount = allocations.length;\n\n// Sum of all allocation percentages for this goal\nconst totalAllocationPercent = allocations.reduce(\n  (sum, a) => sum + a.allocatedPercent,\n  0,\n);\n\n// Average: (sum of percentages) / (total accounts * 100) * 100\n// Example: Goal has 50% from account1 + 50% from account2, with 2 total accounts\n// (50 + 50) / (2 * 100) * 100 = 50%\nconst averageAllocationPercent =\n  totalAccountCount > 0\n    ? (totalAllocationPercent / (totalAccountCount * 100)) * 100\n    : 0;\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Interpretation:"})," If a goal has allocations totaling 100% across 2 accounts\nout of 4 total accounts, the average is 25% (100 / 400 * 100)."]}),"\n",(0,a.jsx)(n.h3,{id:"status-logic",children:"Status Logic"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'const getGoalStatus = () => {\n  // Priority 1: Check if achieved\n  if (goal.isAchieved) return "Completed";\n\n  const today = new Date();\n  const startDate = goal.startDate ? new Date(goal.startDate) : null;\n  const dueDate = goal.dueDate ? new Date(goal.dueDate) : null;\n\n  // Priority 2: Check if not started yet\n  if (startDate && startDate > today) return "Not Started";\n\n  // Priority 3: Check if past due date\n  if (dueDate && dueDate < today) return "Overdue";\n\n  // Default: Goal is active\n  return "Ongoing";\n};\n'})}),"\n",(0,a.jsx)(n.h3,{id:"track-status-logic",children:"Track Status Logic"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'const getTrackStatus = () => {\n  // Achieved goals show "Done"\n  if (goal.isAchieved) return { text: "Done", color: "success" };\n\n  // Goals not started yet show no status\n  if (startDate && startDate > today) return { text: "", color: "muted" };\n\n  // Active goals compare actual vs projected\n  if (isOnTrack) return { text: "On Track", color: "on-track-green" };\n\n  return { text: "Off Track", color: "off-track-amber" };\n};\n'})}),"\n",(0,a.jsx)(n.h3,{id:"progress-bar-color",children:"Progress Bar Color"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsxs)(n.strong,{children:["Green (",(0,a.jsx)(n.code,{children:"bg-primary"}),")"]})," - Goal is on track OR achieved"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsxs)(n.strong,{children:["Amber (",(0,a.jsx)(n.code,{children:"bg-amber-500"}),")"]})," - Goal is off track"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"goal-allocations-table",children:"Goal Allocations Table"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"File:"})," ",(0,a.jsx)(n.code,{children:"src/pages/goals/components/goal-allocations.tsx"})]}),"\n",(0,a.jsx)(n.h3,{id:"structure",children:"Structure"}),"\n",(0,a.jsx)(n.p,{children:"A matrix table with:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Rows:"})," One per goal"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Columns:"})," One per account + goal name column"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Cells:"})," Allocation percentage input (or display in read-only mode)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"props-1",children:"Props"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface GoalsAllocationsProps {\n  goals: Goal[];\n  accounts: Account[];\n  existingAllocations?: GoalAllocation[];\n  allAllocations?: GoalAllocation[]; // All allocations including other goals\n  onSubmit: (allocations: GoalAllocation[]) => void;\n  readOnly?: boolean;\n  showRemaining?: boolean;\n  currentAccountValues?: Map<string, number>; // For displaying remaining value\n  currency?: string;\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"unallocated-row-calculation",children:"Unallocated Row Calculation"}),"\n",(0,a.jsx)(n.p,{children:'The table shows an "Unallocated" row at the top:'}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// Remaining percentage for each account\nconst remainingPercent = Math.max(0, 100 - totalAllocations[account.id]);\n\n// Remaining value in currency\n// Sum of initial contributions already allocated\nconst totalAllocated = allocations.reduce((sum, alloc) => {\n  return alloc.accountId === account.id\n    ? sum + (alloc.initialContribution || 0)\n    : sum;\n}, 0);\n\n// Remaining = Current Account Value - Total Allocated\nconst remainingValue = Math.max(0, currentValue - totalAllocated);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"table-display-per-goal-row",children:"Table Display Per Goal Row"}),"\n",(0,a.jsx)(n.p,{children:"Each goal row shows two sub-rows:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Percentage Row"})," - Input field for ",(0,a.jsx)(n.code,{children:"allocatedPercent"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Initial Contribution Row"})," - Display of ",(0,a.jsx)(n.code,{children:"initialContribution"})," amount"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"validation",children:"Validation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Total allocations per account cannot exceed 100%"}),"\n",(0,a.jsx)(n.li,{children:"Submit is blocked if any account exceeds 100%"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"goal-form",children:"Goal Form"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"File:"})," ",(0,a.jsx)(n.code,{children:"src/pages/goals/components/goal-form.tsx"})]}),"\n",(0,a.jsx)(n.h3,{id:"form-fields",children:"Form Fields"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Field"}),(0,a.jsx)(n.th,{children:"Type"}),(0,a.jsx)(n.th,{children:"Required"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"title"})}),(0,a.jsx)(n.td,{children:"Text"}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"Goal name"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"description"})}),(0,a.jsx)(n.td,{children:"Textarea"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"Goal description"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"targetAmount"})}),(0,a.jsx)(n.td,{children:"Money"}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"Target value to achieve"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"startDate"})}),(0,a.jsx)(n.td,{children:"Date"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"When goal tracking begins"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"dueDate"})}),(0,a.jsx)(n.td,{children:"Date"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"Target completion date"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"targetReturnRate"})}),(0,a.jsx)(n.td,{children:"Number (0-100)"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"Expected annual return %"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"monthlyInvestment"})}),(0,a.jsx)(n.td,{children:"Money"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"Monthly DCA amount (auto-calculated)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"isAchieved"})}),(0,a.jsx)(n.td,{children:"Switch"}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsx)(n.td,{children:"Mark goal as complete (edit mode only)"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"auto-calculate-monthly-investment",children:"Auto-Calculate Monthly Investment"}),"\n",(0,a.jsxs)(n.p,{children:["When ",(0,a.jsx)(n.code,{children:"targetAmount"}),", ",(0,a.jsx)(n.code,{children:"targetReturnRate"}),", ",(0,a.jsx)(n.code,{children:"startDate"}),", and ",(0,a.jsx)(n.code,{children:"dueDate"})," are all\nprovided, the monthly investment is auto-calculated:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// Calculate months between dates\nconst monthsDiff =\n  (end.getFullYear() - start.getFullYear()) * 12 +\n  (end.getMonth() - start.getMonth());\n\n// Monthly interest rate\nconst monthlyRate = targetReturnRate / 100 / 12;\n\nlet monthlyInvestment: number;\n\nif (monthlyRate === 0) {\n  // Simple division (no compound interest)\n  monthlyInvestment = targetAmount / monthsDiff;\n} else {\n  // PMT formula: Target / [((1 + r)^n - 1) / r]\n  const compoundFactor = Math.pow(1 + monthlyRate, monthsDiff);\n  monthlyInvestment = targetAmount / ((compoundFactor - 1) / monthlyRate);\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Formula (PMT for Future Value of Annuity):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"PMT = FV / [((1 + r)^n - 1) / r]\n\nWhere:\n- FV = targetAmount (future value target)\n- r = monthlyRate (targetReturnRate / 100 / 12)\n- n = monthsDiff (number of months)\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"key-formulas",children:"Key Formulas"}),"\n",(0,a.jsx)(n.h3,{id:"1-current-value-contributed-value",children:"1. Current Value (Contributed Value)"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"File:"})," ",(0,a.jsx)(n.code,{children:"src/pages/goals/use-goal-progress.ts"})]}),"\n",(0,a.jsx)(n.p,{children:"The current value of a goal is the sum of contributed values from all\nallocations:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Current Value = \u03a3 (Initial Contribution + Allocated Growth)\n\nWhere for each allocation:\n  Allocated Growth = (Current Account Value - Account Value at Start) \xd7 (allocatedPercent / 100)\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// For each allocation\nconst accountGrowth = currentAccountValue - startAccountValue;\nconst allocatedGrowth = accountGrowth * (allocatedPercent / 100);\nconst allocatedValue = initialContribution + allocatedGrowth;\n\n// Sum all allocations\ncurrentValue += allocatedValue;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Example:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Initial Contribution: $10,000"}),"\n",(0,a.jsx)(n.li,{children:"Account value at allocation start: $50,000"}),"\n",(0,a.jsx)(n.li,{children:"Current account value: $60,000"}),"\n",(0,a.jsx)(n.li,{children:"Allocated percent: 50%"}),"\n",(0,a.jsx)(n.li,{children:"Account Growth: $60,000 - $50,000 = $10,000"}),"\n",(0,a.jsx)(n.li,{children:"Allocated Growth: $10,000 \xd7 50% = $5,000"}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.strong,{children:"Contributed Value: $10,000 + $5,000 = $15,000"})}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-progress-percentage",children:"2. Progress Percentage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const progress =\n  goal.targetAmount > 0\n    ? Math.min((currentValue / goal.targetAmount) * 100, 100)\n    : 0;\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Formula:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Progress = min((Current Value / Target Amount) \xd7 100, 100)\n"})}),"\n",(0,a.jsx)(n.p,{children:"Progress is capped at 100%."}),"\n",(0,a.jsx)(n.h3,{id:"3-projected-value-for-on-track-determination",children:"3. Projected Value (for On-Track Determination)"}),"\n",(0,a.jsx)(n.p,{children:"Uses compound interest formula with regular contributions:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"FV = PMT \xd7 [((1 + r)^n - 1) / r]\n\nWhere:\n- FV = Projected Future Value (Growth from contributions only)\n- PMT = monthlyInvestment\n- r = monthlyRate (annualReturnRate / 100 / 12)\n- n = monthsFromStart (months from goal start to today)\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Code:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function calculateProjectedValue(\n  _startValue: number, // Unused: Initial contributions are excluded from projection logic\n  monthlyInvestment: number,\n  annualReturnRate: number,\n  monthsFromStart: number,\n): number {\n  if (monthsFromStart <= 0) return 0;\n\n  const monthlyRate = annualReturnRate / 100 / 12;\n\n  if (monthlyRate === 0) {\n    // No compound interest\n    return monthlyInvestment * monthsFromStart;\n  }\n\n  const compoundFactor = Math.pow(1 + monthlyRate, monthsFromStart);\n  const futureContributions =\n    monthlyInvestment * ((compoundFactor - 1) / monthlyRate);\n\n  return futureContributions;\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.em,{children:["Note: The actual implementation uses ",(0,a.jsx)(n.code,{children:"calculateProjectedValueByDate"}),' for higher precision, but the logic remains the same regarding the exclusion of initial principal growth in the "Projected" line.']})}),"\n",(0,a.jsx)(n.h3,{id:"4-on-track-determination",children:"4. On-Track Determination"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"File:"})," ",(0,a.jsx)(n.code,{children:"src/pages/goals/lib/goal-utils.ts"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"export function isGoalOnTrack(\n  currentValue: number,\n  projectedValue: number,\n): boolean {\n  return currentValue >= projectedValue;\n}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Rule:"}),' A goal is "on track" if the actual current value meets or exceeds the\nprojected value at today\'s date.']}),"\n",(0,a.jsx)(n.h3,{id:"5-months-from-start-calculation",children:"5. Months From Start Calculation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"const goalStartDate = parseISO(goal.startDate);\nconst today = new Date();\nconst yearDiff = today.getFullYear() - goalStartDate.getFullYear();\nconst monthDiff = today.getMonth() - goalStartDate.getMonth();\nconst daysDiff = today.getDate() - goalStartDate.getDate();\n\n// Fractional months for precision\nconst monthsFromStart = yearDiff * 12 + monthDiff + daysDiff / 30;\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"business-rules",children:"Business Rules"}),"\n",(0,a.jsx)(n.h3,{id:"allocation-rules",children:"Allocation Rules"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"100% Cap Per Account"})," - Sum of all ",(0,a.jsx)(n.code,{children:"allocatedPercent"})," for a single account\nacross all goals cannot exceed 100%"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Initial Contribution Cap"})," - Cannot exceed the unallocated balance at the\nallocation date"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Growth Attribution"})," - Account growth (positive or negative) is split\nproportionally among goals based on their ",(0,a.jsx)(n.code,{children:"allocatedPercent"})]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Negative Growth"})," - Losses reduce goal value (allocated growth can be\nnegative)"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Allocation Date Filtering"})," - Allocations with a future ",(0,a.jsx)(n.code,{children:"allocationDate"}),"\nare excluded from current value calculations"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"goal-status-rules",children:"Goal Status Rules"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Condition"}),(0,a.jsx)(n.th,{children:"Status"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"isAchieved === true"})}),(0,a.jsx)(n.td,{children:"Completed"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"startDate > today"})}),(0,a.jsx)(n.td,{children:"Not Started"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"dueDate < today"})," AND not achieved"]}),(0,a.jsx)(n.td,{children:"Overdue"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"Otherwise"}),(0,a.jsx)(n.td,{children:"Ongoing"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"track-status-rules",children:"Track Status Rules"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Condition"}),(0,a.jsx)(n.th,{children:"Status"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"isAchieved === true"})}),(0,a.jsx)(n.td,{children:"Done"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"startDate > today"})}),(0,a.jsx)(n.td,{children:"(no status shown)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"currentValue >= projectedValue"})}),(0,a.jsx)(n.td,{children:"On Track"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"currentValue < projectedValue"})}),(0,a.jsx)(n.td,{children:"Off Track"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"data-source-rules",children:"Data Source Rules"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Account Values"})," - Always use ",(0,a.jsx)(n.code,{children:"latestValuations"})," from the valuations query,\nNOT ",(0,a.jsx)(n.code,{children:"account.balance"})," which may be stale"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Historical Values"})," - For growth calculations, fetch historical valuations\nat the allocation/goal start date"]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Currency"})," - All values displayed in user's base currency from settings"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/wealth-vn/docs/development/goals/goal-actual-growth-business-logic",children:"Goal Actual Growth Business Logic"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/wealth-vn/docs/development/goals/projected-value-business-logic",children:"Projected Value Business Logic"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"/wealth-vn/docs/development/goals/allocation-setting-plan",children:"Allocation Setting Plan"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8193(e,n,t){t.d(n,{R:()=>r,x:()=>o});var l=t(758);const a={},s=l.createContext(a);function r(e){const n=l.useContext(s);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);