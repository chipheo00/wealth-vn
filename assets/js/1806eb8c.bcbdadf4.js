"use strict";(self.webpackChunkwealthvn_docs=self.webpackChunkwealthvn_docs||[]).push([[6904],{1864(n,l,e){e.r(l),e.d(l,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>s});const i=JSON.parse('{"id":"development/goals/allocation-setting-plan","title":"Goal Allocation Setting Plan","description":"Overview","source":"@site/docs/development/goals/allocation-setting-plan.md","sourceDirName":"development/goals","slug":"/development/goals/allocation-setting-plan","permalink":"/wealth-vn/docs/development/goals/allocation-setting-plan","draft":false,"unlisted":false,"editUrl":"https://github.com/chipheo00/vn-wealthfolio/tree/main/docs/docs/development/goals/allocation-setting-plan.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Goals Logic","permalink":"/wealth-vn/docs/development/goals/goal-page-logic"},"next":{"title":"Goal Actual Growth Business Logic","permalink":"/wealth-vn/docs/development/goals/goal-actual-growth-business-logic"}}');var a=e(6070),o=e(8193);const t={},c="Goal Allocation Setting Plan",r={},s=[{value:"Overview",id:"overview",level:2},{value:"Allocation Approach",id:"allocation-approach",level:2},{value:"New Goal Initialization",id:"new-goal-initialization",level:3},{value:"Initial Allocation",id:"initial-allocation",level:3},{value:"Example",id:"example",level:3},{value:"Growth Calculation",id:"growth-calculation",level:2},{value:"Rules and Constraints",id:"rules-and-constraints",level:2},{value:"Active/Archived Goals",id:"activearchived-goals",level:3},{value:"Goal Deletion (Removal)",id:"goal-deletion-removal",level:3},{value:"Reallocation to New Goal",id:"reallocation-to-new-goal",level:3},{value:"Allocation Editing",id:"allocation-editing",level:2},{value:"Edit Amount (Init Valuation)",id:"edit-amount-init-valuation",level:3},{value:"Edit Percentage (Allocation Strategy)",id:"edit-percentage-allocation-strategy",level:3},{value:"Allocation History &amp; Versioning",id:"allocation-history--versioning",level:2},{value:"Growth Calculation with History",id:"growth-calculation-with-history",level:2},{value:"Validation Logic",id:"validation-logic",level:2},{value:"Implementation Requirements",id:"implementation-requirements",level:2},{value:"Edge Cases",id:"edge-cases",level:2}];function d(n){const l={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.header,{children:(0,a.jsx)(l.h1,{id:"goal-allocation-setting-plan",children:"Goal Allocation Setting Plan"})}),"\n",(0,a.jsx)(l.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsxs)(l.p,{children:["Hybrid approach: both ",(0,a.jsx)(l.strong,{children:"value-based"})," and ",(0,a.jsx)(l.strong,{children:"percentage-based"})," allocation to prevent double-counting while properly attributing growth across multiple goals."]}),"\n",(0,a.jsx)(l.h2,{id:"allocation-approach",children:"Allocation Approach"}),"\n",(0,a.jsx)(l.h3,{id:"new-goal-initialization",children:"New Goal Initialization"}),"\n",(0,a.jsx)(l.p,{children:"When a goal is created, allocations are initialized with:"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"allocationAmount"}),": 0 for all accounts"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"allocationPercentage"}),": 0 for all accounts"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"allocationDate"}),": ",(0,a.jsx)(l.code,{children:"goal.startDate"})," (not creation date)"]}),"\n"]}),"\n",(0,a.jsx)(l.p,{children:"This allows users to allocate values later, with the allocation date anchored to the goal's start period."}),"\n",(0,a.jsx)(l.h3,{id:"initial-allocation",children:"Initial Allocation"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["User specifies an ",(0,a.jsx)(l.strong,{children:"explicit amount"})," to allocate from unallocated account balance"]}),"\n",(0,a.jsxs)(l.li,{children:["User also specifies an ",(0,a.jsx)(l.strong,{children:"allocation percentage"})," for this goal"]}),"\n",(0,a.jsxs)(l.li,{children:["Allocation percentage = ",(0,a.jsx)(l.code,{children:"allocated_amount / account_value_at_allocation_date"})]}),"\n",(0,a.jsxs)(l.li,{children:["Init valuation is ",(0,a.jsx)(l.strong,{children:"locked in"})," (immutable)"]}),"\n"]}),"\n",(0,a.jsx)(l.h3,{id:"example",children:"Example"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Account A balance at goal start date: $1000"}),"\n",(0,a.jsx)(l.li,{children:"Goal 1: allocated $500"}),"\n",(0,a.jsx)(l.li,{children:"Goal 2: allocated $300"}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Unallocated"}),": $200 (available for new goals)"]}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"growth-calculation",children:"Growth Calculation"}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Fixed init valuation, proportional growth:"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Goal init value = $500 (locked, never changes)"}),"\n",(0,a.jsx)(l.li,{children:"Allocation ratio = $500 / $1000 = 50%"}),"\n",(0,a.jsx)(l.li,{children:"Account grows to $1100 (+$100 gain)"}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Goal actual gain"})," = 50% \xd7 $100 = $50"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Goal current value"})," = $500 + $50 = $550"]}),"\n"]}),"\n",(0,a.jsxs)(l.p,{children:["Growth is attributed ",(0,a.jsx)(l.strong,{children:"only to the allocation percentage"}),", not the entire account movement."]}),"\n",(0,a.jsx)(l.h2,{id:"rules-and-constraints",children:"Rules and Constraints"}),"\n",(0,a.jsx)(l.h3,{id:"activearchived-goals",children:"Active/Archived Goals"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["Remain ",(0,a.jsx)(l.strong,{children:"completely untouched"})," by other goal operations"]}),"\n",(0,a.jsx)(l.li,{children:"No value reshuffling between active goals"}),"\n",(0,a.jsx)(l.li,{children:"Each goal maintains independent allocation and valuation tracking"}),"\n"]}),"\n",(0,a.jsx)(l.h3,{id:"goal-deletion-removal",children:"Goal Deletion (Removal)"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["Goal A deleted \u2192 its current value becomes ",(0,a.jsx)(l.strong,{children:"free/unallocated"})]}),"\n",(0,a.jsx)(l.li,{children:"This unallocated balance is now available for new goal allocations"}),"\n",(0,a.jsx)(l.li,{children:"No cascading impact on other active goals"}),"\n"]}),"\n",(0,a.jsx)(l.h3,{id:"reallocation-to-new-goal",children:"Reallocation to New Goal"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["User can only allocate from ",(0,a.jsx)(l.strong,{children:"unallocated balance"})]}),"\n",(0,a.jsx)(l.li,{children:"Cannot take value from other active/archived goals"}),"\n",(0,a.jsx)(l.li,{children:"New allocation uses current value as init valuation"}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"allocation-editing",children:"Allocation Editing"}),"\n",(0,a.jsx)(l.h3,{id:"edit-amount-init-valuation",children:"Edit Amount (Init Valuation)"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"User updates allocated amount (e.g., $500 \u2192 $600)"}),"\n",(0,a.jsxs)(l.li,{children:["Goal's ",(0,a.jsx)(l.strong,{children:"init valuation recalculates"})," to new amount"]}),"\n",(0,a.jsx)(l.li,{children:"Changes the baseline going forward"}),"\n",(0,a.jsx)(l.li,{children:"Historical growth already locked in (no retroactive changes)"}),"\n",(0,a.jsx)(l.li,{children:"Freed/required balance impacts unallocated pool"}),"\n"]}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Example:"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Current allocation: $500"}),"\n",(0,a.jsx)(l.li,{children:"User edits to $600 \u2192 init valuation becomes $600"}),"\n",(0,a.jsx)(l.li,{children:"Unallocated pool decreases by $100"}),"\n"]}),"\n",(0,a.jsx)(l.h3,{id:"edit-percentage-allocation-strategy",children:"Edit Percentage (Allocation Strategy)"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["User edits percentage for a ",(0,a.jsx)(l.strong,{children:"specific historical period only"})]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Init amount stays locked"})," (never changes)"]}),"\n",(0,a.jsx)(l.li,{children:"Only the growth calculation for that period recalculates with new %"}),"\n",(0,a.jsx)(l.li,{children:"Other periods and current value update accordingly"}),"\n",(0,a.jsx)(l.li,{children:"No impact to periods before or after the edited period"}),"\n"]}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Example:"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Account A: $1000 initial"}),"\n",(0,a.jsx)(l.li,{children:"Goal A: $500 allocated @ 50%"}),"\n",(0,a.jsx)(l.li,{children:"Account A grows: $1000 \u2192 $1100 (+$100)"}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Before edit:"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Growth = $100 \xd7 50% = $50"}),"\n",(0,a.jsx)(l.li,{children:"Goal value = $500 + $50 = $550"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"User edits: 50% \u2192 70%"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Init amount: $500 \u2713 (unchanged)"}),"\n",(0,a.jsx)(l.li,{children:"Growth recalculated: $100 \xd7 70% = $70"}),"\n",(0,a.jsx)(l.li,{children:"Goal value: $500 + $70 = $570"}),"\n",(0,a.jsx)(l.li,{children:"Impact: +$20 additional gain (only in this period)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"allocation-history--versioning",children:"Allocation History & Versioning"}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Track allocation changes:"})}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{children:"Allocation History:\n- Version 1: Amount=$500, Percentage=50%, Date=Jan 1, Status=Active\n- Version 2: Amount=$600, Percentage=50%, Date=Feb 15, Status=Active\n- Version 3: Amount=$600, Percentage=60%, Date=Apr 1, Status=Active\n"})}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Each version stores:"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Amount"}),"\n",(0,a.jsx)(l.li,{children:"Percentage"}),"\n",(0,a.jsx)(l.li,{children:"Start date (when this version became active)"}),"\n",(0,a.jsx)(l.li,{children:"End date (when next version started, or null if current)"}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"growth-calculation-with-history",children:"Growth Calculation with History"}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Segmented growth:"})}),"\n",(0,a.jsxs)(l.ol,{children:["\n",(0,a.jsxs)(l.li,{children:["For each allocation period (between version changes), calculate:","\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:(0,a.jsx)(l.code,{children:"period_gain = (account_value_end - account_value_start) \xd7 allocation_percentage"})}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(l.li,{children:"Sum all period gains for total actual gain"}),"\n",(0,a.jsx)(l.li,{children:"Current value = init_amount + total_actual_gain"}),"\n"]}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Unallocated balance growth:"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Unallocated percentage = 100% - sum(all_goal_percentages)"}),"\n",(0,a.jsx)(l.li,{children:"Unallocated balance grows with its own allocation percentage"}),"\n",(0,a.jsx)(l.li,{children:"When user creates new goal later, they allocate from the grown unallocated balance"}),"\n"]}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Example Timeline:"})}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{children:"Initial State:\n- Account A: $1000\n- Goal 1: $500 @ 50%\n- Goal 2: $300 @ 30%\n- Unallocated: $200 @ 20%\n\nAfter Account A grows to $1100 (+$100):\n- Goal 1 value: $500 + ($100 \xd7 50%) = $550\n- Goal 2 value: $300 + ($100 \xd7 30%) = $330\n- Unallocated: $200 + ($100 \xd7 20%) = $220 \u2190 also grows!\n\nUser creates Goal 3 (allocates from unallocated):\n- Goal 3 init amount: $220 (the grown unallocated balance)\n- Goal 3 percentage: 20%\n- From now on: Goal 3 grows with 20% of future Account A growth\n"})}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Validation always holds:"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:(0,a.jsx)(l.code,{children:"sum(goal_values) + unallocated_value = account_current_value"})}),"\n"]}),"\n",(0,a.jsx)(l.p,{children:(0,a.jsx)(l.strong,{children:"Example with segmented periods:"})}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Period 1 (Jan 1 - Feb 15): Growth $100 @ 50% = $50"}),"\n",(0,a.jsx)(l.li,{children:"Period 2 (Feb 15 - Apr 1): Growth $150 @ 50% = $75"}),"\n",(0,a.jsx)(l.li,{children:"Period 3 (Apr 1 - Now): Growth $80 @ 60% = $48"}),"\n",(0,a.jsx)(l.li,{children:(0,a.jsx)(l.strong,{children:"Total gain = $173"})}),"\n",(0,a.jsx)(l.li,{children:(0,a.jsx)(l.strong,{children:"Current value = $600 + $173 = $773"})}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"validation-logic",children:"Validation Logic"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{children:"sum(all_goal_allocations) + unallocated_balance = account_total_value\n"})}),"\n",(0,a.jsx)(l.p,{children:"Before allocation:"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["User selects amount ",(0,a.jsx)(l.code,{children:"X"})," from unallocated balance"]}),"\n",(0,a.jsxs)(l.li,{children:["Validate: ",(0,a.jsx)(l.code,{children:"X <= unallocated_balance"})]}),"\n",(0,a.jsxs)(l.li,{children:["Calculate allocation ratio: ",(0,a.jsx)(l.code,{children:"X / account_value_at_allocation_date"})]}),"\n",(0,a.jsx)(l.li,{children:"Store ratio for future growth calculations"}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"implementation-requirements",children:"Implementation Requirements"}),"\n",(0,a.jsxs)(l.ol,{children:["\n",(0,a.jsxs)(l.li,{children:["\n",(0,a.jsxs)(l.p,{children:["Track ",(0,a.jsx)(l.strong,{children:"allocation history"})," per account-goal pair"]}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Amount allocated"}),"\n",(0,a.jsx)(l.li,{children:"Allocation ratio"}),"\n",(0,a.jsx)(l.li,{children:"Allocation date"}),"\n",(0,a.jsx)(l.li,{children:"Status (active/archived)"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(l.li,{children:["\n",(0,a.jsxs)(l.p,{children:["Calculate ",(0,a.jsx)(l.strong,{children:"actual gain"})," from growth"]}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"Current account value"}),"\n",(0,a.jsx)(l.li,{children:"Previous account value (at allocation date)"}),"\n",(0,a.jsx)(l.li,{children:"Gain = (current - previous) \xd7 allocation_ratio"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(l.li,{children:["\n",(0,a.jsxs)(l.p,{children:["Maintain ",(0,a.jsx)(l.strong,{children:"unallocated pool"})]}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:["Real-time calculation: ",(0,a.jsx)(l.code,{children:"account_value - sum(all_allocations)"})]}),"\n",(0,a.jsx)(l.li,{children:"UI validation before allocation"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(l.li,{children:["\n",(0,a.jsxs)(l.p,{children:["Handle ",(0,a.jsx)(l.strong,{children:"goal deletion"})]}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"When goal deleted, mark as deleted"}),"\n",(0,a.jsx)(l.li,{children:"Add current value to unallocated pool"}),"\n",(0,a.jsx)(l.li,{children:"Don't touch other goals' allocations"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(l.h2,{id:"edge-cases",children:"Edge Cases"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Account value fluctuations"}),": Percentage-based growth calculation handles naturally"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Multiple allocations same account"}),": Each goal gets proportional share of growth"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Account value < sum of allocations"}),": Should be prevented by validation"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Reallocating between goals"}),": Only from unallocated pool, not between active goals"]}),"\n"]})]})}function h(n={}){const{wrapper:l}={...(0,o.R)(),...n.components};return l?(0,a.jsx)(l,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},8193(n,l,e){e.d(l,{R:()=>t,x:()=>c});var i=e(758);const a={},o=i.createContext(a);function t(n){const l=i.useContext(o);return i.useMemo(function(){return"function"==typeof n?n(l):{...l,...n}},[l,n])}function c(n){let l;return l=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:t(n.components),i.createElement(o.Provider,{value:l},n.children)}}}]);