"use strict";(self.webpackChunkwealthvn_docs=self.webpackChunkwealthvn_docs||[]).push([[6904],{1864(e,n,l){l.r(n),l.d(n,{assets:()=>s,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>r});const a=JSON.parse('{"id":"development/goals/allocation-setting-plan","title":"Goal Allocation Setting Plan","description":"Overview","source":"@site/docs/development/goals/allocation-setting-plan.md","sourceDirName":"development/goals","slug":"/development/goals/allocation-setting-plan","permalink":"/wealth-vn/docs/development/goals/allocation-setting-plan","draft":false,"unlisted":false,"editUrl":"https://github.com/chipheo00/vn-wealthfolio/tree/main/docs/docs/development/goals/allocation-setting-plan.md","tags":[],"version":"current","frontMatter":{"id":"allocation-setting-plan","title":"Goal Allocation Setting Plan","sidebar_label":"Allocation Setting Plan"},"sidebar":"tutorialSidebar","previous":{"title":"Goals Logic","permalink":"/wealth-vn/docs/development/goals/goal-page-logic"},"next":{"title":"Completed Goals","permalink":"/wealth-vn/docs/development/goals/completed-goals"}}');var t=l(6070),i=l(8193);const o={id:"allocation-setting-plan",title:"Goal Allocation Setting Plan",sidebar_label:"Allocation Setting Plan"},c="Goal Allocation Setting Plan",s={},r=[{value:"Overview",id:"overview",level:2},{value:"Allocation Approach",id:"allocation-approach",level:2},{value:"New Goal Initialization",id:"new-goal-initialization",level:3},{value:"Initial Allocation",id:"initial-allocation",level:3},{value:"Example",id:"example",level:3},{value:"Growth Calculation",id:"growth-calculation",level:2},{value:"Rules and Constraints",id:"rules-and-constraints",level:2},{value:"Active/Archived Goals",id:"activearchived-goals",level:3},{value:"Goal Deletion (Removal)",id:"goal-deletion-removal",level:3},{value:"Reallocation to New Goal",id:"reallocation-to-new-goal",level:3},{value:"Allocation Editing",id:"allocation-editing",level:2},{value:"Edit Amount (Init Valuation)",id:"edit-amount-init-valuation",level:3},{value:"Edit Percentage (Allocation Strategy)",id:"edit-percentage-allocation-strategy",level:3},{value:"Allocation History &amp; Versioning",id:"allocation-history--versioning",level:2},{value:"Growth Calculation with History",id:"growth-calculation-with-history",level:2},{value:"Validation Logic",id:"validation-logic",level:2},{value:"Implementation Requirements",id:"implementation-requirements",level:2},{value:"Edge Cases",id:"edge-cases",level:2},{value:"Time-Aware Allocation Logic",id:"time-aware-allocation-logic",level:2},{value:"Core Concepts",id:"core-concepts",level:3},{value:"Contributed Value",id:"contributed-value",level:4},{value:"Time-Aware Unallocated Balance",id:"time-aware-unallocated-balance",level:4},{value:"Date Range Overlap",id:"date-range-overlap",level:4},{value:"Utility Functions",id:"utility-functions",level:3},{value:"<code>doDateRangesOverlap()</code>",id:"dodaterangesoverlap",level:4},{value:"<code>calculateAllocationContributedValue()</code>",id:"calculateallocationcontributedvalue",level:4},{value:"<code>calculateUnallocatedBalance()</code>",id:"calculateunallocatedbalance",level:4},{value:"Component Implementation",id:"component-implementation",level:3},{value:"Edit Allocations Modal",id:"edit-allocations-modal",level:4},{value:"Examples",id:"examples",level:3},{value:"Example 1: Sequential Goals (No Overlap)",id:"example-1-sequential-goals-no-overlap",level:4},{value:"Example 2: Overlapping Goals",id:"example-2-overlapping-goals",level:4},{value:"Example 3: Future Goal",id:"example-3-future-goal",level:4},{value:"Backend Date Handling",id:"backend-date-handling",level:3},{value:"Allocation Dates in Database",id:"allocation-dates-in-database",level:4},{value:"Start Date Change Behavior",id:"start-date-change-behavior",level:4},{value:"End Date Change Behavior",id:"end-date-change-behavior",level:4},{value:"Frontend Components",id:"frontend-components",level:3},{value:"EditAllocationsModal",id:"editallocationsmodal",level:4},{value:"EditSingleAllocationModal",id:"editsingleallocationmodal",level:4},{value:"Completed Goals",id:"completed-goals",level:2},{value:"Allocation Release",id:"allocation-release",level:3},{value:"Historical Records",id:"historical-records",level:3},{value:"UI Changes",id:"ui-changes",level:3},{value:"Technical Implementation",id:"technical-implementation",level:3},{value:"Related Documentation",id:"related-documentation",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"goal-allocation-setting-plan",children:"Goal Allocation Setting Plan"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["Hybrid approach: both ",(0,t.jsx)(n.strong,{children:"value-based"})," and ",(0,t.jsx)(n.strong,{children:"percentage-based"})," allocation to prevent double-counting while properly attributing growth across multiple goals."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Features:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Time-aware unallocated balance calculation"}),"\n",(0,t.jsx)(n.li,{children:"Date range overlap detection for percentage calculations"}),"\n",(0,t.jsx)(n.li,{children:"Historical value tracking for accurate attribution"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"allocation-approach",children:"Allocation Approach"}),"\n",(0,t.jsx)(n.h3,{id:"new-goal-initialization",children:"New Goal Initialization"}),"\n",(0,t.jsx)(n.p,{children:"When a goal is created, allocations are initialized with:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"allocationAmount"}),": 0 for all accounts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"allocationPercentage"}),": 0 for all accounts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"allocationDate"}),": ",(0,t.jsx)(n.code,{children:"goal.startDate"})," (not creation date)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This allows users to allocate values later, with the allocation date anchored to the goal's start period."}),"\n",(0,t.jsx)(n.h3,{id:"initial-allocation",children:"Initial Allocation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["User specifies an ",(0,t.jsx)(n.strong,{children:"explicit amount"})," to allocate from unallocated account balance"]}),"\n",(0,t.jsxs)(n.li,{children:["User also specifies an ",(0,t.jsx)(n.strong,{children:"allocation percentage"})," for this goal"]}),"\n",(0,t.jsxs)(n.li,{children:["Allocation percentage = ",(0,t.jsx)(n.code,{children:"allocated_amount / account_value_at_allocation_date"})]}),"\n",(0,t.jsxs)(n.li,{children:["Init valuation is ",(0,t.jsx)(n.strong,{children:"locked in"})," (immutable)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Account A balance at goal start date: $1000"}),"\n",(0,t.jsx)(n.li,{children:"Goal 1: allocated $500"}),"\n",(0,t.jsx)(n.li,{children:"Goal 2: allocated $300"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unallocated"}),": $200 (available for new goals)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"growth-calculation",children:"Growth Calculation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Fixed init valuation, proportional growth:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Goal init value = $500 (locked, never changes)"}),"\n",(0,t.jsx)(n.li,{children:"Allocation ratio = $500 / $1000 = 50%"}),"\n",(0,t.jsx)(n.li,{children:"Account grows to $1100 (+$100 gain)"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Goal actual gain"})," = 50% \xd7 $100 = $50"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Goal current value"})," = $500 + $50 = $550"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Growth is attributed ",(0,t.jsx)(n.strong,{children:"only to the allocation percentage"}),", not the entire account movement."]}),"\n",(0,t.jsx)(n.h2,{id:"rules-and-constraints",children:"Rules and Constraints"}),"\n",(0,t.jsx)(n.h3,{id:"activearchived-goals",children:"Active/Archived Goals"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Remain ",(0,t.jsx)(n.strong,{children:"completely untouched"})," by other goal operations"]}),"\n",(0,t.jsx)(n.li,{children:"No value reshuffling between active goals"}),"\n",(0,t.jsx)(n.li,{children:"Each goal maintains independent allocation and valuation tracking"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"goal-deletion-removal",children:"Goal Deletion (Removal)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Goal A deleted \u2192 its current value becomes ",(0,t.jsx)(n.strong,{children:"free/unallocated"})]}),"\n",(0,t.jsx)(n.li,{children:"This unallocated balance is now available for new goal allocations"}),"\n",(0,t.jsx)(n.li,{children:"No cascading impact on other active goals"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"reallocation-to-new-goal",children:"Reallocation to New Goal"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["User can only allocate from ",(0,t.jsx)(n.strong,{children:"unallocated balance"})]}),"\n",(0,t.jsx)(n.li,{children:"Cannot take value from other active/archived goals"}),"\n",(0,t.jsx)(n.li,{children:"New allocation uses current value as init valuation"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"allocation-editing",children:"Allocation Editing"}),"\n",(0,t.jsx)(n.h3,{id:"edit-amount-init-valuation",children:"Edit Amount (Init Valuation)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"User updates allocated amount (e.g., $500 \u2192 $600)"}),"\n",(0,t.jsxs)(n.li,{children:["Goal's ",(0,t.jsx)(n.strong,{children:"init valuation recalculates"})," to new amount"]}),"\n",(0,t.jsx)(n.li,{children:"Changes the baseline going forward"}),"\n",(0,t.jsx)(n.li,{children:"Historical growth already locked in (no retroactive changes)"}),"\n",(0,t.jsx)(n.li,{children:"Freed/required balance impacts unallocated pool"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Current allocation: $500"}),"\n",(0,t.jsx)(n.li,{children:"User edits to $600 \u2192 init valuation becomes $600"}),"\n",(0,t.jsx)(n.li,{children:"Unallocated pool decreases by $100"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"edit-percentage-allocation-strategy",children:"Edit Percentage (Allocation Strategy)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["User edits percentage for a ",(0,t.jsx)(n.strong,{children:"specific historical period only"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Init amount stays locked"})," (never changes)"]}),"\n",(0,t.jsx)(n.li,{children:"Only the growth calculation for that period recalculates with new %"}),"\n",(0,t.jsx)(n.li,{children:"Other periods and current value update accordingly"}),"\n",(0,t.jsx)(n.li,{children:"No impact to periods before or after the edited period"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Account A: $1000 initial"}),"\n",(0,t.jsx)(n.li,{children:"Goal A: $500 allocated @ 50%"}),"\n",(0,t.jsx)(n.li,{children:"Account A grows: $1000 \u2192 $1100 (+$100)"}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Before edit:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Growth = $100 \xd7 50% = $50"}),"\n",(0,t.jsx)(n.li,{children:"Goal value = $500 + $50 = $550"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"User edits: 50% \u2192 70%"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Init amount: $500 \u2713 (unchanged)"}),"\n",(0,t.jsx)(n.li,{children:"Growth recalculated: $100 \xd7 70% = $70"}),"\n",(0,t.jsx)(n.li,{children:"Goal value: $500 + $70 = $570"}),"\n",(0,t.jsx)(n.li,{children:"Impact: +$20 additional gain (only in this period)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"allocation-history--versioning",children:"Allocation History & Versioning"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Track allocation changes:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Allocation History:\n- Version 1: Amount=$500, Percentage=50%, Date=Jan 1, Status=Active\n- Version 2: Amount=$600, Percentage=50%, Date=Feb 15, Status=Active\n- Version 3: Amount=$600, Percentage=60%, Date=Apr 1, Status=Active\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Each version stores:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Amount"}),"\n",(0,t.jsx)(n.li,{children:"Percentage"}),"\n",(0,t.jsx)(n.li,{children:"Start date (when this version became active)"}),"\n",(0,t.jsx)(n.li,{children:"End date (when next version started, or null if current)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"growth-calculation-with-history",children:"Growth Calculation with History"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Segmented growth:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["For each allocation period (between version changes), calculate:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"period_gain = (account_value_end - account_value_start) \xd7 allocation_percentage"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Sum all period gains for total actual gain"}),"\n",(0,t.jsx)(n.li,{children:"Current value = init_amount + total_actual_gain"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Unallocated balance growth:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Unallocated percentage = 100% - sum(all_goal_percentages)"}),"\n",(0,t.jsx)(n.li,{children:"Unallocated balance grows with its own allocation percentage"}),"\n",(0,t.jsx)(n.li,{children:"When user creates new goal later, they allocate from the grown unallocated balance"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example Timeline:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Initial State:\n- Account A: $1000\n- Goal 1: $500 @ 50%\n- Goal 2: $300 @ 30%\n- Unallocated: $200 @ 20%\n\nAfter Account A grows to $1100 (+$100):\n- Goal 1 value: $500 + ($100 \xd7 50%) = $550\n- Goal 2 value: $300 + ($100 \xd7 30%) = $330\n- Unallocated: $200 + ($100 \xd7 20%) = $220 \u2190 also grows!\n\nUser creates Goal 3 (allocates from unallocated):\n- Goal 3 init amount: $220 (the grown unallocated balance)\n- Goal 3 percentage: 20%\n- From now on: Goal 3 grows with 20% of future Account A growth\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Validation always holds:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"sum(goal_values) + unallocated_value = account_current_value"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example with segmented periods:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Period 1 (Jan 1 - Feb 15): Growth $100 @ 50% = $50"}),"\n",(0,t.jsx)(n.li,{children:"Period 2 (Feb 15 - Apr 1): Growth $150 @ 50% = $75"}),"\n",(0,t.jsx)(n.li,{children:"Period 3 (Apr 1 - Now): Growth $80 @ 60% = $48"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Total gain = $173"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Current value = $600 + $173 = $773"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"validation-logic",children:"Validation Logic"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sum(all_goal_allocations) + unallocated_balance = account_total_value\n"})}),"\n",(0,t.jsx)(n.p,{children:"Before allocation:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["User selects amount ",(0,t.jsx)(n.code,{children:"X"})," from unallocated balance"]}),"\n",(0,t.jsxs)(n.li,{children:["Validate: ",(0,t.jsx)(n.code,{children:"X <= unallocated_balance"})]}),"\n",(0,t.jsxs)(n.li,{children:["Calculate allocation ratio: ",(0,t.jsx)(n.code,{children:"X / account_value_at_allocation_date"})]}),"\n",(0,t.jsx)(n.li,{children:"Store ratio for future growth calculations"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"implementation-requirements",children:"Implementation Requirements"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Track ",(0,t.jsx)(n.strong,{children:"allocation history"})," per account-goal pair"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Amount allocated"}),"\n",(0,t.jsx)(n.li,{children:"Allocation ratio"}),"\n",(0,t.jsx)(n.li,{children:"Allocation date"}),"\n",(0,t.jsx)(n.li,{children:"Status (active/archived)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Calculate ",(0,t.jsx)(n.strong,{children:"actual gain"})," from growth"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Current account value"}),"\n",(0,t.jsx)(n.li,{children:"Previous account value (at allocation date)"}),"\n",(0,t.jsx)(n.li,{children:"Gain = (current - previous) \xd7 allocation_ratio"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Maintain ",(0,t.jsx)(n.strong,{children:"unallocated pool"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Real-time calculation: ",(0,t.jsx)(n.code,{children:"account_value - sum(all_allocations)"})]}),"\n",(0,t.jsx)(n.li,{children:"UI validation before allocation"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Handle ",(0,t.jsx)(n.strong,{children:"goal deletion"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When goal deleted, mark as deleted"}),"\n",(0,t.jsx)(n.li,{children:"Add current value to unallocated pool"}),"\n",(0,t.jsx)(n.li,{children:"Don't touch other goals' allocations"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"edge-cases",children:"Edge Cases"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Account value fluctuations"}),": Percentage-based growth calculation handles naturally"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multiple allocations same account"}),": Each goal gets proportional share of growth"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Account value < sum of allocations"}),": Should be prevented by validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reallocating between goals"}),": Only from unallocated pool, not between active goals"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Sequential goals (no overlap)"}),": Goals that don't overlap in time don't affect each other's percentage availability"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Goal start date change"}),": Resets all allocations for that goal (requires user confirmation)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Goal end date change"}),": Updates all allocations' end dates to maintain overlap logic"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"time-aware-allocation-logic",children:"Time-Aware Allocation Logic"}),"\n",(0,t.jsx)(n.p,{children:"When managing multiple financial goals that share the same investment accounts, the system needs to accurately track:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unallocated Balance"}),": How much of an account's value is available for a new goal"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Unallocated Percentage"}),": What percentage of future growth is available for allocation"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The challenge arises when goals have ",(0,t.jsx)(n.strong,{children:"different start dates and end dates"}),". A simple sum of allocated percentages doesn't account for:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Goals that have already ended before the new goal starts"}),"\n",(0,t.jsx)(n.li,{children:"Goals that haven't started yet when calculating available balance"}),"\n",(0,t.jsx)(n.li,{children:'The actual "contributed value" of each allocation at different points in time'}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,t.jsx)(n.h4,{id:"contributed-value",children:"Contributed Value"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"Contributed Value"})," of an allocation at any point in time is:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"ContributedValue = InitialContribution + (AccountGrowth \xd7 AllocationPercent)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Where:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"InitialContribution"})," = The fixed dollar amount allocated when the goal started"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"AccountGrowth"})," = ",(0,t.jsx)(n.code,{children:"AccountValue(QueryDate) - AccountValue(AllocationStartDate)"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"AllocationPercent"})," = The percentage of growth this goal is entitled to (0-100%)"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"time-aware-unallocated-balance",children:"Time-Aware Unallocated Balance"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"Unallocated Balance"})," for a goal at its start date is:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"UnallocatedBalance = AccountValueAtGoalStart - \u03a3(OtherAllocations' ContributedValues)\n"})}),"\n",(0,t.jsx)(n.p,{children:"This is calculated by:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Getting the account value at the ",(0,t.jsx)(n.strong,{children:"current goal's start date"})]}),"\n",(0,t.jsxs)(n.li,{children:["For each ",(0,t.jsx)(n.strong,{children:"other goal's allocation"})," on this account:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Calculate its contributed value UP TO the current goal's start date"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Subtract the sum of contributed values from the account value"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"date-range-overlap",children:"Date Range Overlap"}),"\n",(0,t.jsxs)(n.p,{children:["For ",(0,t.jsx)(n.strong,{children:"percentage calculations"}),", allocations are only counted if their time periods ",(0,t.jsx)(n.strong,{children:"overlap"})," with the current goal. Two date ranges overlap if:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"A.startDate < B.endDate AND A.endDate > B.startDate\n"})}),"\n",(0,t.jsx)(n.p,{children:"This means:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Goals that end before the current goal starts \u2192 ",(0,t.jsx)(n.strong,{children:"Not counted"})]}),"\n",(0,t.jsxs)(n.li,{children:["Goals that start after the current goal ends \u2192 ",(0,t.jsx)(n.strong,{children:"Not counted"})]}),"\n",(0,t.jsxs)(n.li,{children:["Goals that partially or fully overlap \u2192 ",(0,t.jsx)(n.strong,{children:"Counted"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"utility-functions",children:"Utility Functions"}),"\n",(0,t.jsxs)(n.p,{children:["Located in ",(0,t.jsx)(n.code,{children:"src/pages/goals/lib/goal-utils.ts"}),":"]}),"\n",(0,t.jsx)(n.h4,{id:"dodaterangesoverlap",children:(0,t.jsx)(n.code,{children:"doDateRangesOverlap()"})}),"\n",(0,t.jsx)(n.p,{children:"Checks if two date ranges overlap."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function doDateRangesOverlap(\n  startA: string | Date | undefined,\n  endA: string | Date | undefined,\n  startB: string | Date | undefined,\n  endB: string | Date | undefined,\n): boolean {\n  if (!startA || !endA || !startB || !endB) {\n    return false; // Conservative: if dates missing, assume no overlap\n  }\n\n  const dateStartA = new Date(startA);\n  const dateEndA = new Date(endA);\n  const dateStartB = new Date(startB);\n  const dateEndB = new Date(endB);\n\n  return dateStartA < dateEndB && dateEndA > dateStartB;\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"calculateallocationcontributedvalue",children:(0,t.jsx)(n.code,{children:"calculateAllocationContributedValue()"})}),"\n",(0,t.jsx)(n.p,{children:"Calculates the contributed value of an allocation at a specific date."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function calculateAllocationContributedValue(\n  initialContribution: number,\n  allocationPercentage: number,\n  accountValueAtAllocationStart: number,\n  accountValueAtQueryDate: number,\n  allocationStartDate: Date,\n  queryDate: Date\n): number {\n  // If query date is before allocation started, no contribution yet\n  if (queryDate < allocationStartDate) {\n    return 0;\n  }\n\n  // Calculate account growth since allocation start\n  const accountGrowth = Math.max(0, accountValueAtQueryDate - accountValueAtAllocationStart);\n\n  // Allocated portion of growth\n  const allocatedGrowth = accountGrowth * (allocationPercentage / 100);\n\n  // Total contributed value = initial + growth\n  return initialContribution + allocatedGrowth;\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"calculateunallocatedbalance",children:(0,t.jsx)(n.code,{children:"calculateUnallocatedBalance()"})}),"\n",(0,t.jsx)(n.p,{children:"Calculates the remaining unallocated balance."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export function calculateUnallocatedBalance(\n  accountValueAtQueryDate: number,\n  otherAllocationsContributedValues: number[]\n): number {\n  const totalContributed = otherAllocationsContributedValues.reduce((sum, v) => sum + v, 0);\n  return Math.max(0, accountValueAtQueryDate - totalContributed);\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"component-implementation",children:"Component Implementation"}),"\n",(0,t.jsx)(n.h4,{id:"edit-allocations-modal",children:"Edit Allocations Modal"}),"\n",(0,t.jsxs)(n.p,{children:["Located in ",(0,t.jsx)(n.code,{children:"src/pages/goals/components/edit-allocations-modal.tsx"}),":"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Historical Values Fetching:"})}),"\n",(0,t.jsx)(n.p,{children:"The modal fetches account valuations at multiple dates:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Current goal's start date"})," - For calculating the base value"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Each other allocation's start date"})," - For calculating their contributed values"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// Fetch requests for historical values\nconst fetchRequests: { accountId: string; date: string }[] = [];\n\n// 1. Current goal's start date (for all accounts)\nfor (const account of accounts) {\n  fetchRequests.push({ accountId: account.id, date: currentGoalStartDate });\n}\n\n// 2. Other allocations' start dates\nfor (const alloc of allAllocations) {\n  if (alloc.goalId === goal.id) continue; // Skip current goal\n  const allocStartDate = alloc.allocationDate || alloc.startDate;\n  fetchRequests.push({ accountId: alloc.accountId, date: allocStartDate });\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Unallocated Balance Calculation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const calculateAvailableBalances = () => {\n  for (const account of accounts) {\n    // Get account value at current goal's start date\n    let accountValueAtGoalStart: number;\n    if (isPastGoal) {\n      accountValueAtGoalStart = historicalValuesCache[getCacheKey(account.id, currentGoalStartDate)] ?? 0;\n    } else {\n      accountValueAtGoalStart = currentAccountValues.get(account.id) || 0;\n    }\n\n    // Calculate contributed values from OTHER goals' allocations\n    const contributedValues: number[] = [];\n    for (const alloc of allAllocations) {\n      if (alloc.goalId === goal.id) continue;\n      if (alloc.accountId !== account.id) continue;\n\n      const contributedValue = calculateAllocationContributedValue(\n        alloc.initialContribution || 0,\n        alloc.allocatedPercent || 0,\n        accountValueAtAllocStart,\n        accountValueAtGoalStart,\n        allocStartDateObj,\n        goalStartDateObj\n      );\n      contributedValues.push(contributedValue);\n    }\n\n    // Unallocated balance = Account value - Sum of contributed values\n    balances[account.id] = calculateUnallocatedBalance(accountValueAtGoalStart, contributedValues);\n  }\n};\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Time-Aware Percentage Calculation:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const otherGoalsPercent = allAllocations.reduce((sum, existingAlloc) => {\n  if (existingAlloc.accountId !== account.id) return sum;\n  if (existingAlloc.goalId === goal.id) return sum;\n\n  // Only count allocations that OVERLAP with current goal's time period\n  const overlaps = doDateRangesOverlap(\n    goal.startDate,           // Current goal start\n    goal.dueDate,             // Current goal end\n    existingAlloc.startDate,  // Other allocation start\n    existingAlloc.endDate     // Other allocation end\n  );\n\n  if (!overlaps) return sum;\n\n  return sum + (existingAlloc.allocatedPercent || 0);\n}, 0);\n\nconst remainingUnallocatedPercent = Math.max(0, 100 - otherGoalsPercent - currentInputPercent);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h4,{id:"example-1-sequential-goals-no-overlap",children:"Example 1: Sequential Goals (No Overlap)"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Goal"}),(0,t.jsx)(n.th,{children:"Start Date"}),(0,t.jsx)(n.th,{children:"End Date"}),(0,t.jsx)(n.th,{children:"Account A"}),(0,t.jsx)(n.th,{children:"Initial"}),(0,t.jsx)(n.th,{children:"Alloc %"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Goal 1"}),(0,t.jsx)(n.td,{children:"2025-01-01"}),(0,t.jsx)(n.td,{children:"2030-12-31"}),(0,t.jsx)(n.td,{children:"$100,000"}),(0,t.jsx)(n.td,{children:"$50,000"}),(0,t.jsx)(n.td,{children:"100%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Goal 2"}),(0,t.jsx)(n.td,{children:"2031-01-01"}),(0,t.jsx)(n.td,{children:"2035-12-31"}),(0,t.jsx)(n.td,{children:"?"}),(0,t.jsx)(n.td,{children:"?"}),(0,t.jsx)(n.td,{children:"?"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Account A value at 2031-01-01"}),": $200,000 (grew from $100,000)"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Calculating Goal 2's unallocated balance:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Goal 1's contributed value at 2031-01-01:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Initial: $50,000"}),"\n",(0,t.jsx)(n.li,{children:"Growth: ($200,000 - $100,000) \xd7 100% = $100,000"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Contributed: $150,000"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Unallocated Balance: $200,000 - $150,000 = ",(0,t.jsx)(n.strong,{children:"$50,000"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Unallocated Percentage:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Goal 1 period (2025-2030) does NOT overlap with Goal 2 (2031-2035)"}),"\n",(0,t.jsxs)(n.li,{children:["Goal 1's 100% is ",(0,t.jsx)(n.strong,{children:"not counted"})]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Unallocated: 100%"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"example-2-overlapping-goals",children:"Example 2: Overlapping Goals"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Goal"}),(0,t.jsx)(n.th,{children:"Start Date"}),(0,t.jsx)(n.th,{children:"End Date"}),(0,t.jsx)(n.th,{children:"Account A"}),(0,t.jsx)(n.th,{children:"Initial"}),(0,t.jsx)(n.th,{children:"Alloc %"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Goal 1"}),(0,t.jsx)(n.td,{children:"2025-01-01"}),(0,t.jsx)(n.td,{children:"2030-12-31"}),(0,t.jsx)(n.td,{children:"$100,000"}),(0,t.jsx)(n.td,{children:"$50,000"}),(0,t.jsx)(n.td,{children:"50%"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Goal 2"}),(0,t.jsx)(n.td,{children:"2028-01-01"}),(0,t.jsx)(n.td,{children:"2032-12-31"}),(0,t.jsx)(n.td,{children:"?"}),(0,t.jsx)(n.td,{children:"?"}),(0,t.jsx)(n.td,{children:"?"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Account A value at 2028-01-01"}),": $150,000"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Calculating Goal 2's unallocated balance:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Goal 1's contributed value at 2028-01-01:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Initial: $50,000"}),"\n",(0,t.jsx)(n.li,{children:"Growth: ($150,000 - $100,000) \xd7 50% = $25,000"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Contributed: $75,000"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Unallocated Balance: $150,000 - $75,000 = ",(0,t.jsx)(n.strong,{children:"$75,000"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Unallocated Percentage:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Goal 1 (2025-2030) OVERLAPS with Goal 2 (2028-2032)"}),"\n",(0,t.jsx)(n.li,{children:"Goal 1's 50% IS counted"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Unallocated: 50%"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"example-3-future-goal",children:"Example 3: Future Goal"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Goal"}),(0,t.jsx)(n.th,{children:"Start Date"}),(0,t.jsx)(n.th,{children:"End Date"}),(0,t.jsx)(n.th,{children:"Account A (Current)"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Goal 1"}),(0,t.jsx)(n.td,{children:"2025-01-01"}),(0,t.jsx)(n.td,{children:"2030-12-31"}),(0,t.jsx)(n.td,{children:"$100,000 \u2192 $150,000"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Goal 3"}),(0,t.jsx)(n.td,{children:"2026-01-01"}),(0,t.jsx)(n.td,{children:"2028-12-31"}),(0,t.jsx)(n.td,{children:"?"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Today"}),": 2024-12-24 (Goal 3 is in the future)"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Calculating Goal 3's unallocated balance:"})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Since Goal 3 is in the future, use ",(0,t.jsx)(n.strong,{children:"current account value"}),": $150,000"]}),"\n",(0,t.jsxs)(n.li,{children:["Goal 1's contributed value at current time:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Initial: $50,000"}),"\n",(0,t.jsx)(n.li,{children:"Growth: ($150,000 - $100,000) \xd7 50% = $25,000"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"Contributed: $75,000"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Unallocated Balance: $150,000 - $75,000 = ",(0,t.jsx)(n.strong,{children:"$75,000"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"backend-date-handling",children:"Backend Date Handling"}),"\n",(0,t.jsx)(n.h4,{id:"allocation-dates-in-database",children:"Allocation Dates in Database"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"goals_allocation"})," table stores:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"allocation_date"}),": Legacy field (often NULL)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"start_date"}),": Backfilled from goal's ",(0,t.jsx)(n.code,{children:"start_date"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"end_date"}),": Backfilled from goal's ",(0,t.jsx)(n.code,{children:"due_date"})]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"start-date-change-behavior",children:"Start Date Change Behavior"}),"\n",(0,t.jsxs)(n.p,{children:["When a goal's ",(0,t.jsx)(n.code,{children:"start_date"})," is changed:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["All allocations for that goal are ",(0,t.jsx)(n.strong,{children:"reset"})," (values set to 0)"]}),"\n",(0,t.jsx)(n.li,{children:"User is shown a confirmation dialog before proceeding"}),"\n",(0,t.jsxs)(n.li,{children:["This is handled in ",(0,t.jsx)(n.code,{children:"goals_service.rs"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"// When start_date changes, reset all allocations\nif new_goal.start_date != existing_goal.start_date {\n    self.repository.reset_allocations_for_goal(&goal.id).await?;\n}\n"})}),"\n",(0,t.jsx)(n.h4,{id:"end-date-change-behavior",children:"End Date Change Behavior"}),"\n",(0,t.jsxs)(n.p,{children:["When a goal's ",(0,t.jsx)(n.code,{children:"due_date"})," is changed:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["All allocations' ",(0,t.jsx)(n.code,{children:"end_date"})," is updated to match"]}),"\n",(0,t.jsx)(n.li,{children:"This maintains the time-aware overlap logic"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-rust",children:"// When due_date changes, update allocations' end_date\nif new_goal.due_date != existing_goal.due_date {\n    self.repository.update_allocations_end_date(&goal.id, &new_goal.due_date).await?;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"frontend-components",children:"Frontend Components"}),"\n",(0,t.jsx)(n.h4,{id:"editallocationsmodal",children:"EditAllocationsModal"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"src/pages/goals/components/edit-allocations-modal.tsx"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Props"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"goal: Goal"})," - Current goal (includes startDate, dueDate)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"allAllocations: GoalAllocation[]"})," - All allocations across all goals"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"currentAccountValues: Map<string, number>"})," - Current account values"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Features"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Fetches historical valuations at multiple dates"}),"\n",(0,t.jsx)(n.li,{children:"Calculates time-aware unallocated balance"}),"\n",(0,t.jsx)(n.li,{children:"Shows dynamic update as user types"}),"\n",(0,t.jsx)(n.li,{children:"Validates against unallocated balance"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"editsingleallocationmodal",children:"EditSingleAllocationModal"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Location"}),": ",(0,t.jsx)(n.code,{children:"src/pages/goals/components/edit-single-allocation-modal.tsx"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Props"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"goal: { id, title, startDate, dueDate }"})," - Goal info"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"allAllocations: GoalAllocation[]"})," - All allocations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"currentAccountValue: number"})," - Current account value"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Features"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Same time-aware logic as multi-allocation modal"}),"\n",(0,t.jsx)(n.li,{children:"Single account focus"}),"\n",(0,t.jsx)(n.li,{children:"Real-time unallocated balance display"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"completed-goals",children:"Completed Goals"}),"\n",(0,t.jsxs)(n.p,{children:["When a goal is marked as completed (",(0,t.jsx)(n.code,{children:"isAchieved: true"}),"), special behavior is applied:"]}),"\n",(0,t.jsx)(n.h3,{id:"allocation-release",children:"Allocation Release"}),"\n",(0,t.jsxs)(n.p,{children:["Completed goals' allocations are ",(0,t.jsx)(n.strong,{children:"NOT counted"})," in unallocated calculations for other goals:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"// In allocation calculations:\nif (isGoalAchieved(alloc.goalId)) {\n  return sum; // Skip - allocations are released\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"This means:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Percentage Released"}),": Other goals see the full percentage available (e.g., if Goal 1 had 100%, new goals see 100% available)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Balance Available"}),": The contributed value is still tracked historically, but not subtracted from available balance for ",(0,t.jsx)(n.em,{children:"new"})," goals"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"historical-records",children:"Historical Records"}),"\n",(0,t.jsx)(n.p,{children:"Completed goals preserve their historical data:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Chart"}),": Shows the final achievement record (read-only)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Allocation History"}),": Displays the allocations as they were at completion"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No Editing"}),": Edit/delete buttons are hidden for completed goals"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"ui-changes",children:"UI Changes"}),"\n",(0,t.jsx)(n.p,{children:"When viewing a completed goal's detail page:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Element"}),(0,t.jsx)(n.th,{children:"Active Goal"}),(0,t.jsx)(n.th,{children:"Completed Goal"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Header"}),(0,t.jsx)(n.td,{children:"Normal"}),(0,t.jsx)(n.td,{children:'Shows \u2705 "Completed" badge'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Description"}),(0,t.jsx)(n.td,{children:"Normal"}),(0,t.jsx)(n.td,{children:'"Goal achieved. Allocations released."'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:'"Edit Allocations" button'}),(0,t.jsx)(n.td,{children:"Visible"}),(0,t.jsx)(n.td,{children:"Hidden"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Allocations Section"}),(0,t.jsx)(n.td,{children:'"Current Allocations" with edit actions'}),(0,t.jsx)(n.td,{children:'"Allocation History" (read-only)'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Info Message"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:'Green box: "Allocations have been released..."'})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"technical-implementation",children:"Technical Implementation"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Files Modified:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"edit-allocations-modal.tsx"})," - Skip completed goals in calculations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"edit-single-allocation-modal.tsx"})," - Skip completed goals in calculations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"goal-details-page.tsx"})," - Conditional UI for completed goals"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"allocation-history-table.tsx"})," - Pass ",(0,t.jsx)(n.code,{children:"allGoals"})," prop"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"New Props:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"allGoals: Goal[]"})," - Passed to allocation modals/tables to check ",(0,t.jsx)(n.code,{children:"isAchieved"})," status"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/wealth-vn/docs/development/goals/goal-details-page",children:"Goal Detail Page"})," - UI Components"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/wealth-vn/docs/development/goals/projected-value-business-logic",children:"Projected Value Business Logic"})," - Growth calculations"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8193(e,n,l){l.d(n,{R:()=>o,x:()=>c});var a=l(758);const t={},i=a.createContext(t);function o(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);