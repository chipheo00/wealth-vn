"use strict";(self.webpackChunkwealthvn_docs=self.webpackChunkwealthvn_docs||[]).push([[7293],{8193(e,n,l){l.d(n,{R:()=>i,x:()=>c});var t=l(758);const a={},o=t.createContext(a);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},8899(e,n,l){l.r(n),l.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>s});const t=JSON.parse('{"id":"development/goals/goal-actual-growth-business-logic","title":"Goal Actual Growth Business Logic","description":"Overview","source":"@site/docs/development/goals/goal-actual-growth-business-logic.md","sourceDirName":"development/goals","slug":"/development/goals/goal-actual-growth-business-logic","permalink":"/wealth-vn/docs/development/goals/goal-actual-growth-business-logic","draft":false,"unlisted":false,"editUrl":"https://github.com/chipheo00/vn-wealthfolio/tree/main/docs/docs/development/goals/goal-actual-growth-business-logic.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Goal Allocation Setting Plan","permalink":"/wealth-vn/docs/development/goals/allocation-setting-plan"},"next":{"title":"Goal Detail Page","permalink":"/wealth-vn/docs/development/goals/goal-details-page"}}');var a=l(6070),o=l(8193);const i={},c="Goal Actual Growth Business Logic",r={},s=[{value:"Overview",id:"overview",level:2},{value:"Core Concepts",id:"core-concepts",level:2},{value:"1. Allocation Model",id:"1-allocation-model",level:3},{value:"2. Growth Attribution Principle",id:"2-growth-attribution-principle",level:3},{value:"2.1. Contributed Value",id:"21-contributed-value",level:3},{value:"2.2. Goal Growth",id:"22-goal-growth",level:3},{value:"3. Current Value vs Initial Contribution",id:"3-current-value-vs-initial-contribution",level:3},{value:"Calculation Scenarios",id:"calculation-scenarios",level:2},{value:"Scenario 1: Single Account, Single Goal",id:"scenario-1-single-account-single-goal",level:3},{value:"Scenario 2: Single Account, Multiple Goals",id:"scenario-2-single-account-multiple-goals",level:3},{value:"Scenario 3: Multiple Accounts, Single Goal",id:"scenario-3-multiple-accounts-single-goal",level:3},{value:"Scenario 4: Allocation Edits (Amount Change)",id:"scenario-4-allocation-edits-amount-change",level:3},{value:"Scenario 5: Allocation Edits (Percentage Change)",id:"scenario-5-allocation-edits-percentage-change",level:3},{value:"Scenario 6: Segmented Growth (Multiple Allocation Versions)",id:"scenario-6-segmented-growth-multiple-allocation-versions",level:3},{value:"Edge Cases",id:"edge-cases",level:2},{value:"Case 1: Goal Created After Account Has Grown",id:"case-1-goal-created-after-account-has-grown",level:3},{value:"Case 2: Account Value Decreases",id:"case-2-account-value-decreases",level:3},{value:"Case 3: Zero Account Value",id:"case-3-zero-account-value",level:3},{value:"Case 4: Account Grows Before Allocation",id:"case-4-account-grows-before-allocation",level:3},{value:"Case 5: Future-Start Goal (Goal Not Yet Begun)",id:"case-5-future-start-goal-goal-not-yet-begun",level:3},{value:"Implementation Requirements",id:"implementation-requirements",level:2},{value:"1. Backend Calculation (Rust)",id:"1-backend-calculation-rust",level:3},{value:"2. Frontend Calculation (React)",id:"2-frontend-calculation-react",level:3},{value:"3. Modal Display (Edit Allocation)",id:"3-modal-display-edit-allocation",level:3},{value:"4. Data Models",id:"4-data-models",level:3},{value:"Growth Line Chart Calculation",id:"growth-line-chart-calculation",level:2},{value:"Actual Growth Line",id:"actual-growth-line",level:3},{value:"Projected Growth Line",id:"projected-growth-line",level:3},{value:"Validation Rules",id:"validation-rules",level:2},{value:"1. Allocation Constraints",id:"1-allocation-constraints",level:3},{value:"2. Percentage Constraints",id:"2-percentage-constraints",level:3},{value:"3. Unallocated Balance",id:"3-unallocated-balance",level:3},{value:"4. Retroactive Allocation",id:"4-retroactive-allocation",level:3},{value:"Allocation Creation Strategy",id:"allocation-creation-strategy",level:2},{value:"On-Demand Creation (Not Upfront)",id:"on-demand-creation-not-upfront",level:3},{value:"Configuration &amp; Flexibility",id:"configuration--flexibility",level:2},{value:"1. Allocation Amount Changes",id:"1-allocation-amount-changes",level:3},{value:"2. Allocation Percentage Changes",id:"2-allocation-percentage-changes",level:3},{value:"3. Allocation History",id:"3-allocation-history",level:3},{value:"4. Account Selection",id:"4-account-selection",level:3},{value:"Testing Scenarios",id:"testing-scenarios",level:2},{value:"Issues &amp; Known Gaps",id:"issues--known-gaps",level:2},{value:"1. React Hook Logic Errors (<code>useGoalProgress</code>)",id:"1-react-hook-logic-errors-usegoalprogress",level:3},{value:"2. Projection Logic Gaps",id:"2-projection-logic-gaps",level:3},{value:"3. Modal Validation logic",id:"3-modal-validation-logic",level:3},{value:"4. Historical Data Fallbacks",id:"4-historical-data-fallbacks",level:3},{value:"5. Field Naming Consistency",id:"5-field-naming-consistency",level:3},{value:"References",id:"references",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"goal-actual-growth-business-logic",children:"Goal Actual Growth Business Logic"})}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"This document describes the complete business logic for calculating goal actual growth. The system tracks how allocated portfolio values grow over time and attributes that growth correctly across multiple accounts and goals."}),"\n",(0,a.jsx)(n.h2,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,a.jsx)(n.h3,{id:"1-allocation-model",children:"1. Allocation Model"}),"\n",(0,a.jsx)(n.p,{children:"Each goal has allocations across one or more accounts:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"initialContribution"}),": The initial dollar amount allocated (locked at goal start date)."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"allocatedPercent"}),": The percentage of account growth attributed to this goal (0-100%)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"allocationDate"}),": When the allocation was made (typically goal.startDate for initial allocations)"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-growth-attribution-principle",children:"2. Growth Attribution Principle"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Goal Growth = Sum of (Account Growth \xd7 Allocation Percentage) for all accounts\n"})}),"\n",(0,a.jsx)(n.p,{children:"Where:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Account Growth"})," = Current Account Value - Account Value at Goal Start Date"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Allocation Percentage"})," = The percentage of account growth attributed to this goal"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"This allows multiple goals to grow from a single account without double-counting."}),"\n",(0,a.jsx)(n.h3,{id:"21-contributed-value",children:"2.1. Contributed Value"}),"\n",(0,a.jsx)(n.p,{children:"Contributed Value is the total value of the goal at the current date that have contributed to the goal."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Contributed Value = Sum of (initialContribution + Account Growth \xd7 Allocation Percentage) for all accounts\n"})}),"\n",(0,a.jsx)(n.h3,{id:"22-goal-growth",children:"2.2. Goal Growth"}),"\n",(0,a.jsx)(n.p,{children:"Unallocated Value is the value of the account that is not allocated to any goal at the specified date."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Unallocated Value = Account Value at Goal specified Date - sum (contributed value and initialContribution of all goals at the specified date)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-current-value-vs-initial-contribution",children:"3. Current Value vs Initial Contribution"}),"\n",(0,a.jsx)(n.p,{children:"Under the new allocation system:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"initialContribution"}),": The originally allocated amount (locked in at allocation date)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"current_value"}),": initialContribution + attributed_growth"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"growth"}),": current_value - initialContribution"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Important"}),": All allocations are initialized with initialContribution=0 and allocatedPercent=0 when a goal is created. Users then allocate from the unallocated pool."]}),"\n",(0,a.jsx)(n.h2,{id:"calculation-scenarios",children:"Calculation Scenarios"}),"\n",(0,a.jsx)(n.h3,{id:"scenario-1-single-account-single-goal",children:"Scenario 1: Single Account, Single Goal"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value at goal start (2024-01-01) = 0"}),"\n",(0,a.jsx)(n.li,{children:"Account A: Current value (today) = 100,000,000"}),"\n",(0,a.jsx)(n.li,{children:"Goal created today with startDate=2024-01-01"}),"\n",(0,a.jsx)(n.li,{children:"User allocates: initialContribution=0 (can not greater than value at start date), allocatedPercent=50%"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Calculation:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Account growth = 100,000,000 - 0 = 100,000,000\nGoal growth = 100,000,000 \xd7 50% = 50,000,000\nGoal current value = initialContribution + growth = 0 + 50,000,000 = 50,000,000\n"})}),"\n",(0,a.jsx)(n.h3,{id:"scenario-2-single-account-multiple-goals",children:"Scenario 2: Single Account, Multiple Goals"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value at goal start = 0"}),"\n",(0,a.jsx)(n.li,{children:"Account A: Current value = 100,000,000"}),"\n",(0,a.jsx)(n.li,{children:"Goal 1: initialContribution= 0 (can not greater than value at start date), allocatedPercent=50%"}),"\n",(0,a.jsx)(n.li,{children:"Goal 2: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%"}),"\n",(0,a.jsx)(n.li,{children:"Unallocated: 20,000,000 @ 20%"}),"\n",(0,a.jsx)(n.li,{children:"Unallocated growth = 20,000,000"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Calculation:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Account growth = 100,000,000 (from 0 - 100M)\n\nGoal 1:\n  growth = 100,000,000 \xd7 50% = 50,000,000\n  contributedValue = 0 + 50,000,000 = 50,000,000\n\nGoal 2:\n  growth = 100,000,000 \xd7 30% = 30,000,000\n  contributedValue = 0 + 30,000,000 = 30,000,000\n\nUnallocated:\n  growth = 100,000,000 \xd7 20% = 20,000,000\n  unallocatedValue = 20,000,000\n\nValidation: 50M + 30M + 20M = 100M  = Goal Growth (from 0 - 100M)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"scenario-3-multiple-accounts-single-goal",children:"Scenario 3: Multiple Accounts, Single Goal"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account 1: Value at goal start = 0, Current = 100,000,000"}),"\n",(0,a.jsx)(n.li,{children:"Account 2: Value at goal start = 0, Current = 100,000,000"}),"\n",(0,a.jsx)(n.li,{children:"Account 3: Value at goal start = 0, Current = 100,000,000"}),"\n",(0,a.jsxs)(n.li,{children:["Goal 1:","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account 1: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%"}),"\n",(0,a.jsx)(n.li,{children:"Account 2: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%"}),"\n",(0,a.jsx)(n.li,{children:"Account 3: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Calculation:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Account 1 growth = 100,000,000 \xd7 30% = 30,000,000\nAccount 2 growth = 100,000,000 \xd7 30% = 30,000,000\nAccount 3 growth = 100,000,000 \xd7 30% = 30,000,000\n\nGoal 1:\n  total_growth = 30M + 30M + 30M = 90,000,000\n  current = (0 + 0 + 0) + 90M = 90,000,000\n"})}),"\n",(0,a.jsx)(n.h3,{id:"scenario-4-allocation-edits-amount-change",children:"Scenario 4: Allocation Edits (Amount Change)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value at goal start = 1,000, Current account value = 1,100"}),"\n",(0,a.jsx)(n.li,{children:"Goal allocation: initialContribution=500, allocatedPercent=50%"}),"\n",(0,a.jsx)(n.li,{children:"User edits allocation to: initialContribution=600"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before Edit:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Growth = (1,100 - 1,000) \xd7 50% = 50\nContributed Value = 500 + 50 = 550\nUnallocated = 1,100 - 550 = 550\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After Edit:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Growth = (1,100 - 1,000) \xd7 50% = 50 (unchanged - still from historical baseline)\nContributed Value = 600 + 50 = 650\nUnallocated = 1,100 - 650 = 450\n\nImpact:\n- Allocation increased by 100. The initialContribution is now 600. but the init point of actual growth line is start at 600 after make change\n- Unallocated decreased by 100\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Key"}),": The historical growth (50) doesn't change. Only the initialContribution changes."]}),"\n",(0,a.jsx)(n.h3,{id:"scenario-5-allocation-edits-percentage-change",children:"Scenario 5: Allocation Edits (Percentage Change)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value at goal start = 1,000, Current = 1,100"}),"\n",(0,a.jsx)(n.li,{children:"Goal allocation: initialContribution=500, allocatedPercent=50%"}),"\n",(0,a.jsx)(n.li,{children:"User edits percentage to: 70%"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Before Edit:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Growth = (1,100 - 1,000) \xd7 50% = 50\nContributed Value = 500 + 50 = 550\nUnallocated = 1,100 - 550 = 550\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"After Edit:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Growth = (1,100 - 1,000) \xd7 70% = 70\nContributed Value = 500 + 70 = 570\nUnallocated = 1,100 - 570 = 530\n\nImpact:\n- Growth increases by 20 (from the 20% percentage change)\n- InitialContribution stays locked at 500 (no changes)\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Key"}),": initialContribution is immutable. Only growth recalculates based on new percentage. the growth line will start from the new initialContribution point."]}),"\n",(0,a.jsx)(n.h3,{id:"scenario-6-segmented-growth-multiple-allocation-versions",children:"Scenario 6: Segmented Growth (Multiple Allocation Versions)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value at goal start (Jan 1) = 1,000"}),"\n",(0,a.jsx)(n.li,{children:"Value at Feb 15 = 1,100"}),"\n",(0,a.jsx)(n.li,{children:"Value at Apr 1 = 1,250"}),"\n",(0,a.jsx)(n.li,{children:"Current (today) = 1,330"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Allocation History:"}),"\nAssign Acount A to goal"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"initialContribution=0"}),"\n",(0,a.jsx)(n.li,{children:"Version 1: Jan 1 - Feb 15, allocatedPercent=50%"}),"\n",(0,a.jsx)(n.li,{children:"Version 2: Feb 15 - Apr 1, allocatedPercent=50%"}),"\n",(0,a.jsx)(n.li,{children:"Version 3: Apr 1 - today, allocatedPercent=60%"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Calculation:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Period 1 (Jan 1 - Feb 15):\n  goal growth = (1,100 - 1,000) \xd7 50% = 50\n  goal contributedValue = 0 + 50 = 50\n\nPeriod 2 (Feb 15 - Apr 1):\n  goal growth = (1,250 - 1,100) \xd7 50% = 75\n  goal contributedValue = 50 + 75 = 125\n\nPeriod 3 (Apr 1 - today):\n  goal growth = (1,330 - 1,250) \xd7 60% = 48\n  goal contributedValue = 125 + 48 = 173\n\nTotal goal growth = 50 + 75 + 48 = 173\nTotal goal contributedValue = 0 + 173 = 173\n"})}),"\n",(0,a.jsx)(n.p,{children:"Note: The initialContribution is 0, so the contributed value is the same as the growth. The line in chart only change following the changes of growth."}),"\n",(0,a.jsx)(n.h2,{id:"edge-cases",children:"Edge Cases"}),"\n",(0,a.jsx)(n.h3,{id:"case-1-goal-created-after-account-has-grown",children:"Case 1: Goal Created After Account Has Grown"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value on 2024-01-01 = 0"}),"\n",(0,a.jsx)(n.li,{children:"Account A: Current (2025-12-14) = 100,000,000"}),"\n",(0,a.jsx)(n.li,{children:"Goal created today with startDate=2024-01-01"}),"\n",(0,a.jsx)(n.li,{children:"User allocates: initialContribution=0 (account value at start date is 0, not allowed to greater than value at start date), allocatedPercent=50%"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Result:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'Unallocated at goal start date (2024-01-01) = 0\nCannot allocate 50,000,000 when unallocated was 0\n\nThis is INVALID. The system should prevent this with validation:\n"Allocation amount exceeds historical unallocated balance at goal start date"\n\nCorrect approach:\n- User can only allocate UP TO the current unallocated balance\n- OR the system allocates from the grown balance retroactively\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Business Logic Decision:"}),"\nAccording to allocation-setting-plan.md:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"When a goal is created with historical start date, unallocated is calculated at that start date"}),"\n",(0,a.jsx)(n.li,{children:"User can only allocate from that historical unallocated balance (plus its subsequent growth)"}),"\n",(0,a.jsx)(n.li,{children:"If user wants to allocate 50M today, it must come from the 40M unallocated that grew from 0"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"case-2-account-value-decreases",children:"Case 2: Account Value Decreases"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value at goal start = 1,000, Current value = 800"}),"\n",(0,a.jsx)(n.li,{children:"Goal allocation: initialContribution=500, allocatedPercent=50%"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Calculation:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Account growth = 800 - 1,000 = -200 (negative/loss)\nGoal growth = -200 \xd7 50% = -100 (loss proportional to allocation)\nContributed value = 500 + (-100) = 400\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Key"}),": Losses are attributed proportionally to allocations, just like gains."]}),"\n",(0,a.jsx)(n.h3,{id:"case-3-zero-account-value",children:"Case 3: Zero Account Value"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value at goal start = 0, Current value = 100,000,000"}),"\n",(0,a.jsx)(n.li,{children:"Goal allocation: initialContribution=0, allocatedPercent=50% (default initialization)"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Calculation:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Account growth = 100,000,000 - 0 = 100,000,000\nGoal growth = 100,000,000 \xd7 50% = 50,000,000\nContributed value = 0 + 50,000,000 = 50,000,000\n\nThis is valid and shows correct initialization behavior\n"})}),"\n",(0,a.jsx)(n.h3,{id:"case-4-account-grows-before-allocation",children:"Case 4: Account Grows Before Allocation"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Value on 2024-01-01 = 100,000"}),"\n",(0,a.jsx)(n.li,{children:"Account A: Value on 2024-06-01 = 200,000 (grew by 100,000)"}),"\n",(0,a.jsx)(n.li,{children:"Account A: Current value = 300,000"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Scenario A: Allocate on 2024-06-01"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"For the allocation, use:\n- Goal start date: 2024-01-01\n- Allocation date: 2024-06-01\n- Account value at goal start: 100,000\n- Account value at allocation: 200,000\n- Current value: 300,000\n\nUnallocated at goal start = 100,000\nUser can allocate from current unallocated value (which has grown from 100,000 to 200,000)\n\nIf user allocates 150,000 on 2024-06-01:\n- initialContribution: 150,000 (locked in)\n- unallocated: 200,000 - 150,000 = 50,000\n- allocation percentage: manual input (20%)\n\nGrowth calculation:\n- account growth from goal allocation date = 300,000 - 200,000 = 100,000\n- goal growth = 100,000 \xd7 20% = 20,000\n- contributedValue = 150,000 + 20,000 = 170,000\n- unallocated = 50,000 + 100,000* (100% - 20%) = 50,000 + 80,000 = 130,000\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Key"}),": Allocation percentage is based on account value AT ALLOCATION TIME, not goal start time."]}),"\n",(0,a.jsx)(n.h3,{id:"case-5-future-start-goal-goal-not-yet-begun",children:"Case 5: Future-Start Goal (Goal Not Yet Begun)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Setup:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Account A: Current value (2025-12-14) = 100,000"}),"\n",(0,a.jsx)(n.li,{children:"Goal created today with startDate=2025-12-25 (future date, 11 days from now)"}),"\n",(0,a.jsx)(n.li,{children:"Unallocated balance today = 100,000"}),"\n",(0,a.jsx)(n.li,{children:'User opens goal details and clicks "Edit Allocations"'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Behavior:"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'For future-start goals:\n1. Use CURRENT account values as the baseline for "Unallocated Balance"\n   - Unallocated = Account Current Value - Sum(initialContributions of all goals)\n   - Example: 100,000 - 0 = 100,000\n\n2. User can allocate from the current unallocated pool\n   - initialContribution: up to 100,000 (current unallocated)\n   - allocatedPercent: 0-100% (user configurable)\n   - allocationDate: NOT set by user, backend backfills from goal.startDate\n\n3. When goal start date arrives (2025-12-25):\n   - Backend will use historical account value at 2025-12-25\n   - Growth calculated from that historical baseline\n\nExample allocation made today for future-start goal:\n- initialContribution: 50,000\n- allocatedPercent: 40%\n- allocationDate: (empty, backend will set to 2025-12-25)\n- Unallocated remaining: 100,000 - 50,000 = 50,000\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Growth Calculation (after goal start date):"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"Assume on 2025-12-25:\n- Account value = 102,000 (grew by 2,000)\n- Assume on 2026-01-14 (today + 31 days): Account value = 105,000\n\nGoal growth from 2025-12-25 to 2026-01-14:\n- Account growth = 105,000 - 102,000 = 3,000\n- Goal growth = 3,000 \xd7 40% = 1,200\n- Contributed value = 50,000 + 1,200 = 51,200\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Key Characteristics:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Allocations created on-demand (when user opens edit modal, not on goal creation)"}),"\n",(0,a.jsx)(n.li,{children:"Uses current account values, not future/projected values"}),"\n",(0,a.jsx)(n.li,{children:"Backend backfills allocation dates from goal dates"}),"\n",(0,a.jsx)(n.li,{children:"Goal creation succeeds immediately (no dependent allocation save)"}),"\n",(0,a.jsx)(n.li,{children:"Allocation percentages describe future growth attribution, not current ownership"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"implementation-requirements",children:"Implementation Requirements"}),"\n",(0,a.jsx)(n.h3,{id:"1-backend-calculation-rust",children:"1. Backend Calculation (Rust)"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"GoalService.calculate_goal_progress_on_date()"})," must:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-rust",children:"For each allocation:\n  1. Get account value at goal.start_date (baseline)\n  2. Get account value at query_date (current)\n  3. Calculate account_growth = current - baseline\n  4. Calculate allocated_growth = account_growth \xd7 (allocation.percentage / 100)\n  5. Accumulate total_growth\n  6. Return GoalProgressSnapshot with all details\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Current Implementation Status"}),": \u2713 Implemented correctly in ",(0,a.jsx)(n.code,{children:"src-core/src/goals/goals_service.rs"})]}),"\n",(0,a.jsx)(n.h3,{id:"2-frontend-calculation-react",children:"2. Frontend Calculation (React)"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"useGoalProgress()"})," hook must:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"For each goal:\n  1. Find all active allocations (where startDate <= today <= endDate)\n  2. For each allocation:\n     - Get current account value from latestValuations\n     - Calculate: allocated_value = account_value \xd7 (allocation.percentage / 100)\n  3. Sum all allocated_values = currentValue\n  4. Calculate projectedValue using compound interest formula\n  5. Compare currentValue vs projectedValue to determine isOnTrack\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Current Implementation Status"}),": \u26a0\ufe0f Incorrect / Divergent"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Uses ",(0,a.jsx)(n.code,{children:"percentAllocation"})," (should be ",(0,a.jsx)(n.code,{children:"allocatedPercent"})," as per type definitions)"]}),"\n",(0,a.jsxs)(n.li,{children:["Calculates ",(0,a.jsx)(n.code,{children:"allocatedValue"})," as ",(0,a.jsx)(n.code,{children:"totalValue * percentage"}),'. This interprets percentage as "% of Total Account Value" rather than "% of Growth or Attribution"']}),"\n",(0,a.jsx)(n.li,{children:"Does not subtract historical account value at goal start (no access to historical data in this hook)"}),"\n",(0,a.jsxs)(n.li,{children:["Assumes ",(0,a.jsx)(n.code,{children:"startValue"})," is 0 for projections"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-modal-display-edit-allocation",children:"3. Modal Display (Edit Allocation)"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"EditAllocationModal"})," must display:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'For each account:\n  - Value at goal.startDate (historical baseline for past/current goals)\n  - Unallocated at that date\n  - Current user allocation amount\n  - Current allocation percentage\n\nFor future-start goals:\n  - Use CURRENT account values as the baseline\n  - Display "Unallocated" as current unallocated balance\n  - Allocations will have their dates backfilled by backend\n\nValidation:\n  - Sum of allocations <= unallocated balance (at goal start for past goals, current for future goals)\n  - Amount delta fits within available unallocated\n  - Percentage sum <= 100% per account\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Current Implementation Status"}),": \u2713 Checks against Current Value"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Modal receives ",(0,a.jsx)(n.code,{children:"currentAccountValues"})]}),"\n",(0,a.jsxs)(n.li,{children:["Validates that ",(0,a.jsx)(n.code,{children:"initialContribution <= currentAccountValue - sum(other_allocations_init_contributions)"})]}),"\n",(0,a.jsx)(n.li,{children:"For future-start goals: detects future dates and uses current values instead of trying to fetch non-existent historical data"}),"\n",(0,a.jsx)(n.li,{children:"Creates allocations on-demand in submit handler (no default allocations created on goal creation)"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"4-data-models",children:"4. Data Models"}),"\n",(0,a.jsxs)(n.p,{children:["Required fields on ",(0,a.jsx)(n.code,{children:"GoalAllocation"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"- id: string (unique per goal-account pair)\n- goalId: string\n- accountId: string\n- initialContribution: number (the init_amount, locked)\n- allocatedPercent: number (0-100, the growth attribution %)\n- allocationDate: string (when allocated, typically goal.startDate)\n- initAmount: f64 (same as initialContribution, for clarity)\n- startDate: string (goal.startDate, when this allocation begins)\n- endDate: string (goal.dueDate, when this allocation ends)\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Current Implementation Status"}),": \u2713 Types match ",(0,a.jsx)(n.code,{children:"src/lib/types.ts"})," (",(0,a.jsx)(n.code,{children:"allocatedPercent"}),"), but frontend usage in ",(0,a.jsx)(n.code,{children:"useGoalProgress"})," is inconsistent (uses ",(0,a.jsx)(n.code,{children:"percentAllocation"}),")."]}),"\n",(0,a.jsx)(n.h2,{id:"growth-line-chart-calculation",children:"Growth Line Chart Calculation"}),"\n",(0,a.jsx)(n.h3,{id:"actual-growth-line",children:"Actual Growth Line"}),"\n",(0,a.jsx)(n.p,{children:"For each date in chart:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"1. Get account values at that date (historical)\n2. For each allocation:\n   - Lookup allocation version active on that date\n   - Calculate: growth = (account_value_at_date - account_value_at_goal_start) \xd7 percentage\n3. Sum all growth = actual_value at that date\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Key"}),": Use historical account valuations, not current values."]}),"\n",(0,a.jsx)(n.h3,{id:"projected-growth-line",children:"Projected Growth Line"}),"\n",(0,a.jsx)(n.p,{children:"For each date in chart:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"1. Calculate months from goal start to that date\n2. Use compound interest formula:\n   FV = PMT \xd7 [((1 + r)^n - 1) / r]\n\n   Where:\n   - PMT = monthly_investment from goal\n   - r = annual_return_rate / 12 / 100\n   - n = months_from_start\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Current Implementation Status"}),": \u2713 Implemented in ",(0,a.jsx)(n.code,{children:"src/pages/goals/use-goal-valuation-history.ts"})]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Fetches historical valuations correctly"}),"\n",(0,a.jsxs)(n.li,{children:["Calculates actuals attempting to follow: ",(0,a.jsx)(n.code,{children:"initialContribution + (current - start) * percent"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Note"}),": Projection calculation currently ignores the ",(0,a.jsx)(n.code,{children:"startValue"})," (Initial Allocation), projecting only monthly contributions."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"validation-rules",children:"Validation Rules"}),"\n",(0,a.jsx)(n.h3,{id:"1-allocation-constraints",children:"1. Allocation Constraints"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"For each account on any date:\n  Sum(initialContributions for active allocations) <= account_value_at_that_date\n"})}),"\n",(0,a.jsx)(n.h3,{id:"2-percentage-constraints",children:"2. Percentage Constraints"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"For each account on any date:\n  Sum(allocatedPercents for active allocations) <= 100%\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-unallocated-balance",children:"3. Unallocated Balance"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"unallocated_value = account_current_value - sum(initialContributions)\nunallocated_value must be >= 0\n"})}),"\n",(0,a.jsx)(n.h3,{id:"4-retroactive-allocation",children:"4. Retroactive Allocation"}),"\n",(0,a.jsx)(n.p,{children:"When allocating to a goal with historical start date:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'Check at goal start date:\n  requested_allocation <= unallocated_at_goal_start\n\nIf violated:\n  Error: "Cannot allocate more than available at goal start date (YYYY-MM-DD)"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"allocation-creation-strategy",children:"Allocation Creation Strategy"}),"\n",(0,a.jsx)(n.h3,{id:"on-demand-creation-not-upfront",children:"On-Demand Creation (Not Upfront)"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Why allocations are created on-demand (when user opens edit modal) rather than upfront (on goal creation):"})}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Goal Creation Success"}),": Creating allocations upfront couples goal creation to allocation initialization, which can fail. By creating on-demand, goal creation always succeeds."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Future-Start Goals"}),": Future-start goals have no historical baseline, making upfront allocation validation complex. On-demand creation lets users adjust allocations after goal creation with full context."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Simpler Error Handling"}),": If allocation save fails, it happens in the context where the user is actively managing allocations (edit modal), not hidden in goal creation flow."]}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Flexibility"}),": Users can create a goal first, then decide allocation strategy later, even for future-start goals."]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Implementation:"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Goal creation does NOT call ",(0,a.jsx)(n.code,{children:"saveAllocationsMutation"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"EditAllocationModal"})," creates allocations on first save if they don't exist (checked via ",(0,a.jsx)(n.code,{children:"existingAllocations"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:["Both update and create flows use same save path: ",(0,a.jsx)(n.code,{children:"updatedAllocations.push({...})"})]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"configuration--flexibility",children:"Configuration & Flexibility"}),"\n",(0,a.jsx)(n.p,{children:"The actual growth line becomes configurable through:"}),"\n",(0,a.jsx)(n.h3,{id:"1-allocation-amount-changes",children:"1. Allocation Amount Changes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"User edits the initialContribution"}),"\n",(0,a.jsx)(n.li,{children:"Growth recalculates automatically"}),"\n",(0,a.jsx)(n.li,{children:"Unallocated pool adjusts by the delta"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-allocation-percentage-changes",children:"2. Allocation Percentage Changes"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"User edits the growth attribution percentage"}),"\n",(0,a.jsx)(n.li,{children:"Only future/historical growth recalculates"}),"\n",(0,a.jsx)(n.li,{children:"initialContribution remains locked"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-allocation-history",children:"3. Allocation History"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Each edit creates a new version"}),"\n",(0,a.jsx)(n.li,{children:"Growth segments by time period"}),"\n",(0,a.jsx)(n.li,{children:"Total growth = sum of all period gains"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"4-account-selection",children:"4. Account Selection"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"User can allocate from different accounts"}),"\n",(0,a.jsx)(n.li,{children:"Each account's growth is tracked independently"}),"\n",(0,a.jsx)(n.li,{children:"Multi-account goals show per-account breakdown"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"testing-scenarios",children:"Testing Scenarios"}),"\n",(0,a.jsx)(n.p,{children:'All scenarios from "Calculation Scenarios" section should have tests covering:'}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"\u2713 Single account, single goal"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Single account, multiple goals"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Multiple accounts, single goal"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Allocation amount edits"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Allocation percentage edits"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Segmented growth (version history)"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Negative growth (losses)"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Zero baseline values"}),"\n",(0,a.jsx)(n.li,{children:"\u2713 Retroactive allocation to historical start date"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"issues--known-gaps",children:"Issues & Known Gaps"}),"\n",(0,a.jsxs)(n.h3,{id:"1-react-hook-logic-errors-usegoalprogress",children:["1. React Hook Logic Errors (",(0,a.jsx)(n.code,{children:"useGoalProgress"}),")"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Uses incorrect field ",(0,a.jsx)(n.code,{children:"percentAllocation"})," (instead of ",(0,a.jsx)(n.code,{children:"allocatedPercent"}),"), which likely results in ",(0,a.jsx)(n.code,{children:"undefined"})," values at runtime."]}),"\n",(0,a.jsxs)(n.li,{children:["Implements ",(0,a.jsx)(n.code,{children:"Total Value * Percentage"})," logic instead of ",(0,a.jsx)(n.code,{children:"Init + (Growth * Percentage)"}),', conflating "Ownership of Account" with "Attribution of Growth".']}),"\n",(0,a.jsx)(n.li,{children:"Does not fetch historical data to establish baseline."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"2-projection-logic-gaps",children:"2. Projection Logic Gaps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"calculateProjectedValue"})," (in both ",(0,a.jsx)(n.code,{children:"useGoalProgress"})," and ",(0,a.jsx)(n.code,{children:"useGoalValuationHistory"}),") ignores the ",(0,a.jsx)(n.code,{children:"startValue"})," / ",(0,a.jsx)(n.code,{children:"initialContribution"}),". It projects growth ONLY on monthly contributions, effectively assuming 0 starting capital for the projection curve."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"3-modal-validation-logic",children:"3. Modal Validation logic"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\u2713 FIXED: ",(0,a.jsx)(n.code,{children:"EditAllocationModal"})," now correctly handles both past-start and future-start goals"]}),"\n",(0,a.jsx)(n.li,{children:"For future-start goals: detects future dates and uses current account values as baseline (not non-existent historical data)"}),"\n",(0,a.jsx)(n.li,{children:"For past-start goals: uses historical account values at goal.startDate when available"}),"\n",(0,a.jsxs)(n.li,{children:["Subtracts ",(0,a.jsx)(n.code,{children:"sum(initialContributions)"}),' from baseline to find "Available", which is appropriate for both scenarios']}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"4-historical-data-fallbacks",children:"4. Historical Data Fallbacks"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"useGoalValuationHistory"})," defaults ",(0,a.jsx)(n.code,{children:"startDateValue"})," to ",(0,a.jsx)(n.code,{children:"initialContribution"})," if strict historical data for the start date is missing. This is a reasonable fallback but relies on ",(0,a.jsx)(n.code,{children:"initialContribution"})," being accurate."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"5-field-naming-consistency",children:"5. Field Naming Consistency"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"GoalAllocation"})," interface is correct (",(0,a.jsx)(n.code,{children:"allocatedPercent"}),"), but usage in some hooks (",(0,a.jsx)(n.code,{children:"useGoalProgress"}),") is incorrect."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"docs/.temporary/allocation-setting-plan.md"})," - Allocation model design"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"src-core/src/goals/goals_service.rs"})," - Core growth calculation logic"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"src-core/src/goals/goal_progress_model.rs"})," - Data models"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"src/pages/goals/use-goal-progress.ts"})," - Frontend progress calculation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"src/pages/goals/use-goal-valuation-history.ts"})," - Chart data generation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"src/pages/goals/components/edit-allocation-modal.tsx"})," - UI for allocation editing"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);