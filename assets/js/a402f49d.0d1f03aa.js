"use strict";(self.webpackChunkwealthvn_docs=self.webpackChunkwealthvn_docs||[]).push([[3483],{7153(e,l,n){n.r(l),n.d(l,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"development/goals/completed-goals","title":"Completed Goals Documentation","description":"This document describes the behavior, UI changes, and data handling when a goal is marked as completed/achieved in WealthVN.","source":"@site/docs/development/goals/completed-goals.md","sourceDirName":"development/goals","slug":"/development/goals/completed-goals","permalink":"/wealth-vn/docs/development/goals/completed-goals","draft":false,"unlisted":false,"editUrl":"https://github.com/chipheo00/vn-wealthfolio/tree/main/docs/docs/development/goals/completed-goals.md","tags":[],"version":"current","frontMatter":{"id":"completed-goals","title":"Completed Goals Documentation","sidebar_label":"Completed Goals"},"sidebar":"tutorialSidebar","previous":{"title":"Allocation Setting Plan","permalink":"/wealth-vn/docs/development/goals/allocation-setting-plan"},"next":{"title":"Goal Actual Growth Business Logic","permalink":"/wealth-vn/docs/development/goals/goal-actual-growth-business-logic"}}');var a=n(6070),s=n(8193);const i={id:"completed-goals",title:"Completed Goals Documentation",sidebar_label:"Completed Goals"},t="Completed Goals",d={},c=[{value:"Overview",id:"overview",level:2},{value:"Key Behaviors",id:"key-behaviors",level:3},{value:"Data Model",id:"data-model",level:2},{value:"Goal <code>isAchieved</code> Flag",id:"goal-isachieved-flag",level:3},{value:"Frontend Implementation",id:"frontend-implementation",level:2},{value:"Goal Details Page (<code>goal-details-page.tsx</code>)",id:"goal-details-page-goal-details-pagetsx",level:3},{value:"Header Section",id:"header-section",level:4},{value:"Description Text",id:"description-text",level:4},{value:"Hidden Sections",id:"hidden-sections",level:4},{value:"Allocation History",id:"allocation-history",level:4},{value:"Info Banner",id:"info-banner",level:4},{value:"Read-Only Mode",id:"read-only-mode",level:4},{value:"Goals Page (<code>goals-page.tsx</code>)",id:"goals-page-goals-pagetsx",level:3},{value:"Complete Goal Action",id:"complete-goal-action",level:4},{value:"Status Display",id:"status-display",level:4},{value:"Goal Item Component (<code>goal-item.tsx</code>)",id:"goal-item-component-goal-itemtsx",level:3},{value:"Goal Operations (<code>goal-operations.tsx</code>)",id:"goal-operations-goal-operationstsx",level:3},{value:"Edit Allocation Modals",id:"edit-allocation-modals",level:3},{value:"Backend Implementation",id:"backend-implementation",level:2},{value:"Goals Service (<code>goals_service.rs</code>)",id:"goals-service-goals_servicers",level:3},{value:"Loading All Allocations",id:"loading-all-allocations",level:4},{value:"Goals Repository (<code>goals_repository.rs</code>)",id:"goals-repository-goals_repositoryrs",level:3},{value:"Time-Aware Considerations",id:"time-aware-considerations",level:2},{value:"Translation Keys",id:"translation-keys",level:2},{value:"User Flow",id:"user-flow",level:2},{value:"Related Documentation",id:"related-documentation",level:2}];function r(e){const l={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.header,{children:(0,a.jsx)(l.h1,{id:"completed-goals",children:"Completed Goals"})}),"\n",(0,a.jsx)(l.p,{children:"This document describes the behavior, UI changes, and data handling when a goal is marked as completed/achieved in WealthVN."}),"\n",(0,a.jsx)(l.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(l.p,{children:'When a user marks a goal as "achieved" (completed), the system transitions the goal to a read-only historical state while preserving all allocation data for reference and analytics.'}),"\n",(0,a.jsx)(l.h3,{id:"key-behaviors",children:"Key Behaviors"}),"\n",(0,a.jsxs)(l.ol,{children:["\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Allocation Preservation"}),": Completed goals retain their allocations in the database for historical record"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Read-Only Mode"}),": All allocation editing is disabled for completed goals"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Allocation Release"}),': The allocated amounts are "released" back to the unallocated pool']}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"History Display"}),": Allocation history table shows contribution values at goal completion"]}),"\n"]}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h2,{id:"data-model",children:"Data Model"}),"\n",(0,a.jsxs)(l.h3,{id:"goal-isachieved-flag",children:["Goal ",(0,a.jsx)(l.code,{children:"isAchieved"})," Flag"]}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-typescript",children:"interface Goal {\n  id: string;\n  title: string;\n  targetAmount: number;\n  isAchieved: boolean;  // Key flag for completed goals\n  // ... other fields\n}\n"})}),"\n",(0,a.jsxs)(l.p,{children:["When ",(0,a.jsx)(l.code,{children:"isAchieved"})," is set to ",(0,a.jsx)(l.code,{children:"true"}),":"]}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:"The goal is considered completed"}),"\n",(0,a.jsx)(l.li,{children:"UI enters read-only mode"}),"\n",(0,a.jsx)(l.li,{children:"Allocations are excluded from unallocated balance calculations for other goals"}),"\n"]}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h2,{id:"frontend-implementation",children:"Frontend Implementation"}),"\n",(0,a.jsxs)(l.h3,{id:"goal-details-page-goal-details-pagetsx",children:["Goal Details Page (",(0,a.jsx)(l.code,{children:"goal-details-page.tsx"}),")"]}),"\n",(0,a.jsxs)(l.p,{children:["The Goal Details Page adapts its layout based on the ",(0,a.jsx)(l.code,{children:"isAchieved"})," status:"]}),"\n",(0,a.jsx)(l.h4,{id:"header-section",children:"Header Section"}),"\n",(0,a.jsx)(l.p,{children:"For completed goals, a badge is displayed:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-tsx",children:'{goal.isAchieved && (\n  <span className="inline-flex items-center gap-1.5 rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-700">\n    <Icons.Check className="h-4 w-4" />\n    {t("completedGoal.badge")}\n  </span>\n)}\n'})}),"\n",(0,a.jsx)(l.h4,{id:"description-text",children:"Description Text"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-tsx",children:'{goal.isAchieved\n  ? t("completedGoal.description")\n  : t("details.description", { title: goal.title })\n}\n'})}),"\n",(0,a.jsx)(l.h4,{id:"hidden-sections",children:"Hidden Sections"}),"\n",(0,a.jsx)(l.p,{children:'The "Allocation Settings" section (with Edit button) is completely hidden for completed goals:'}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-tsx",children:"{!goal.isAchieved && (\n  <div>\n    {/* Allocation Settings section */}\n  </div>\n)}\n"})}),"\n",(0,a.jsx)(l.h4,{id:"allocation-history",children:"Allocation History"}),"\n",(0,a.jsx)(l.p,{children:"For completed goals, the section title and description change:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-tsx",children:'<h3>\n  {goal.isAchieved ? t("completedGoal.allocationHistory") : t("details.allocations.title")}\n</h3>\n<p>\n  {goal.isAchieved\n    ? t("completedGoal.historyDescription")\n    : t("details.allocations.description")\n  }\n</p>\n'})}),"\n",(0,a.jsx)(l.h4,{id:"info-banner",children:"Info Banner"}),"\n",(0,a.jsx)(l.p,{children:"A green info banner explains the allocation release:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-tsx",children:'{goal.isAchieved && (\n  <div className="mb-4 flex items-center gap-2 rounded-lg border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-700">\n    <Icons.InfoCircle className="h-4 w-4 shrink-0" />\n    <span>{t("completedGoal.allocationsReleased")}</span>\n  </div>\n)}\n'})}),"\n",(0,a.jsx)(l.h4,{id:"read-only-mode",children:"Read-Only Mode"}),"\n",(0,a.jsxs)(l.p,{children:["The ",(0,a.jsx)(l.code,{children:"AllocationHistoryTable"})," receives a ",(0,a.jsx)(l.code,{children:"readOnly"})," prop:"]}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-tsx",children:"<AllocationHistoryTable\n  // ... other props\n  readOnly={goal.isAchieved}\n/>\n"})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsxs)(l.h3,{id:"goals-page-goals-pagetsx",children:["Goals Page (",(0,a.jsx)(l.code,{children:"goals-page.tsx"}),")"]}),"\n",(0,a.jsx)(l.h4,{id:"complete-goal-action",children:"Complete Goal Action"}),"\n",(0,a.jsx)(l.p,{children:"Users can mark an active goal as completed:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-typescript",children:"const handleCompleteGoal = async (goal: Goal) => {\n  await updateGoalMutation.mutateAsync({\n    ...goal,\n    isAchieved: true,\n  });\n};\n"})}),"\n",(0,a.jsx)(l.h4,{id:"status-display",children:"Status Display"}),"\n",(0,a.jsxs)(l.p,{children:["The ",(0,a.jsx)(l.code,{children:"getGoalStatus"})," utility handles completed goals:"]}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-typescript",children:'export function getGoalStatus(goal: Goal, isOnTrack: boolean) {\n  if (goal.isAchieved) {\n    return {\n      text: "Done",\n      colorClass: "text-success",\n      statusText: "Completed",\n      statusClass: "text-success bg-success/10",\n    };\n  }\n  // ... other status logic\n}\n'})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsxs)(l.h3,{id:"goal-item-component-goal-itemtsx",children:["Goal Item Component (",(0,a.jsx)(l.code,{children:"goal-item.tsx"}),")"]}),"\n",(0,a.jsx)(l.p,{children:"Displays visual indicators for completed goals:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-typescript",children:'// Progress bar color\nconst progressBarColor = goal.isAchieved ? "bg-primary" : (isOnTrack ? "bg-primary" : "bg-amber-500");\n\n// Status check\nif (goal.isAchieved) {\n  return {\n    label: "Completed",\n    colorClass: "text-success",\n  };\n}\n'})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsxs)(l.h3,{id:"goal-operations-goal-operationstsx",children:["Goal Operations (",(0,a.jsx)(l.code,{children:"goal-operations.tsx"}),")"]}),"\n",(0,a.jsx)(l.p,{children:'The "Complete" action is only shown for non-achieved goals:'}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-tsx",children:'{onComplete && !goal.isAchieved && (\n  <DropdownMenuItem onClick={() => onComplete(goal)}>\n    <Icons.Check className="mr-2 h-4 w-4" />\n    {t("item.operations.complete")}\n  </DropdownMenuItem>\n)}\n'})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h3,{id:"edit-allocation-modals",children:"Edit Allocation Modals"}),"\n",(0,a.jsxs)(l.p,{children:["Both ",(0,a.jsx)(l.code,{children:"edit-allocations-modal.tsx"})," and ",(0,a.jsx)(l.code,{children:"edit-single-allocation-modal.tsx"})," check the goal status:"]}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-typescript",children:"interface Props {\n  allGoals?: Goal[];  // All goals for checking isAchieved status\n}\n\n// Helper function\nconst isGoalCompleted = useMemo(() => {\n  const goalInfo = allGoals?.find(g => g.id === goalId);\n  return goalInfo?.isAchieved === true;\n}, [goalId, allGoals]);\n"})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h2,{id:"backend-implementation",children:"Backend Implementation"}),"\n",(0,a.jsxs)(l.h3,{id:"goals-service-goals_servicers",children:["Goals Service (",(0,a.jsx)(l.code,{children:"goals_service.rs"}),")"]}),"\n",(0,a.jsx)(l.h4,{id:"loading-all-allocations",children:"Loading All Allocations"}),"\n",(0,a.jsxs)(l.p,{children:["The ",(0,a.jsx)(l.code,{children:"load_goals_allocations"})," method includes completed goals' allocations for display purposes:"]}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-rust",children:"fn load_goals_allocations(&self) -> Result<Vec<GoalsAllocation>> {\n    // Use load_all_allocations to include completed goals' allocations (for display/chart)\n    self.goal_repo.load_all_allocations()\n}\n"})}),"\n",(0,a.jsxs)(l.h3,{id:"goals-repository-goals_repositoryrs",children:["Goals Repository (",(0,a.jsx)(l.code,{children:"goals_repository.rs"}),")"]}),"\n",(0,a.jsx)(l.p,{children:"Two methods for loading allocations:"}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-rust",children:"/// Load allocations ONLY for active (non-achieved) goals - used for validation\nfn load_allocations_for_non_achieved_goals(&self) -> Result<Vec<GoalsAllocation>>;\n\n/// Load ALL allocations including from completed goals (for display purposes)\nfn load_all_allocations(&self) -> Result<Vec<GoalsAllocation>>;\n"})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h2,{id:"time-aware-considerations",children:"Time-Aware Considerations"}),"\n",(0,a.jsx)(l.p,{children:"When calculating unallocated balance for new goals:"}),"\n",(0,a.jsxs)(l.ol,{children:["\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Completed goals' allocations"})," are visible but do NOT reduce the unallocated balance"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Active goals' allocations"})," continue to reduce the unallocated balance"]}),"\n",(0,a.jsxs)(l.li,{children:[(0,a.jsx)(l.strong,{children:"Overlapping date ranges"})," are checked only for active goals"]}),"\n"]}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-typescript",children:"// In edit-allocations-modal.tsx\nconst otherActiveAllocations = allAllocations.filter(alloc => {\n  const goalInfo = allGoals?.find(g => g.id === alloc.goalId);\n\n  // Skip allocations from completed goals\n  if (goalInfo?.isAchieved) return false;\n\n  // Skip allocations from the current goal being edited\n  if (alloc.goalId === goal.id) return false;\n\n  return true;\n});\n"})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h2,{id:"translation-keys",children:"Translation Keys"}),"\n",(0,a.jsxs)(l.p,{children:["Located in ",(0,a.jsx)(l.code,{children:"locales/en/goals.json"})," and ",(0,a.jsx)(l.code,{children:"locales/vi/goals.json"}),":"]}),"\n",(0,a.jsx)(l.pre,{children:(0,a.jsx)(l.code,{className:"language-json",children:'{\n  "completedGoal": {\n    "badge": "Completed",\n    "description": "This goal has been achieved. All allocations are now released.",\n    "allocationHistory": "Allocation History",\n    "historyDescription": "Historical record of account allocations for this completed goal.",\n    "allocationsReleased": "These allocations have been released. The allocated amounts are now available for other goals."\n  }\n}\n'})}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h2,{id:"user-flow",children:"User Flow"}),"\n",(0,a.jsx)(l.mermaid,{value:'flowchart TD\n    A[Active Goal] --\x3e|User clicks Complete| B[Confirmation Dialog]\n    B --\x3e|Confirm| C[Set isAchieved = true]\n    C --\x3e D[Update Goal in Database]\n    D --\x3e E[UI Updates]\n\n    subgraph "UI Changes"\n        E --\x3e F[Show \'Completed\' Badge]\n        E --\x3e G[Hide Allocation Settings]\n        E --\x3e H[Show Historical Allocations]\n        E --\x3e I[Disable All Edit Actions]\n    end\n\n    subgraph "Data Impact"\n        D --\x3e J[Allocations Preserved]\n        D --\x3e K[Excluded from Active Calculations]\n        D --\x3e L[Displayed in Charts/History]\n    end'}),"\n",(0,a.jsx)(l.hr,{}),"\n",(0,a.jsx)(l.h2,{id:"related-documentation",children:"Related Documentation"}),"\n",(0,a.jsxs)(l.ul,{children:["\n",(0,a.jsx)(l.li,{children:(0,a.jsx)(l.a,{href:"/wealth-vn/docs/development/goals/goal-page-logic",children:"Goal Page Business Logic"})}),"\n",(0,a.jsx)(l.li,{children:(0,a.jsx)(l.a,{href:"/wealth-vn/docs/development/goals/allocation-setting-plan",children:"Allocation Setting Plan"})}),"\n",(0,a.jsx)(l.li,{children:(0,a.jsx)(l.a,{href:"/wealth-vn/docs/development/goals/goal-details-page",children:"Goal Details Page"})}),"\n"]})]})}function h(e={}){const{wrapper:l}={...(0,s.R)(),...e.components};return l?(0,a.jsx)(l,{...e,children:(0,a.jsx)(r,{...e})}):r(e)}},8193(e,l,n){n.d(l,{R:()=>i,x:()=>t});var o=n(758);const a={},s=o.createContext(a);function i(e){const l=o.useContext(s);return o.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function t(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),o.createElement(s.Provider,{value:l},e.children)}}}]);