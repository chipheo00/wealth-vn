<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-development/goals/goal-actual-growth-business-logic" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Goal Actual Growth Business Logic | WealthVN Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://chipheo00.github.io/wealth-vn/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://chipheo00.github.io/wealth-vn/img/social-card.png"><meta data-rh="true" property="og:url" content="https://chipheo00.github.io/wealth-vn/docs/development/goals/goal-actual-growth-business-logic"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Goal Actual Growth Business Logic | WealthVN Documentation"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/wealth-vn/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chipheo00.github.io/wealth-vn/docs/development/goals/goal-actual-growth-business-logic"><link data-rh="true" rel="alternate" href="https://chipheo00.github.io/wealth-vn/docs/development/goals/goal-actual-growth-business-logic" hreflang="en"><link data-rh="true" rel="alternate" href="https://chipheo00.github.io/wealth-vn/docs/development/goals/goal-actual-growth-business-logic" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Goal Actual Growth Business Logic","item":"https://chipheo00.github.io/wealth-vn/docs/development/goals/goal-actual-growth-business-logic"}]}</script><link rel="stylesheet" href="/wealth-vn/assets/css/styles.3fe6edb2.css">
<script src="/wealth-vn/assets/js/runtime~main.80a86afd.js" defer="defer"></script>
<script src="/wealth-vn/assets/js/main.161c3d64.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XRY4" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/wealth-vn/"><div class="navbar__logo"><img src="/wealth-vn/img/logo.png" alt="WealthVN Logo" class="themedComponent_wC9N themedComponent--light_T_OS"><img src="/wealth-vn/img/logo.png" alt="WealthVN Logo" class="themedComponent_wC9N themedComponent--dark_y3IB"></div><b class="navbar__title text--truncate">WealthVN</b></a><a class="navbar__item navbar__link" href="/wealth-vn/">Trang Chủ</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/wealth-vn/docs">Tài Liệu</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/chipheo00/vn-wealthfolio" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_qkBQ"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_arGu colorModeToggle_ntwj"><button class="clean-btn toggleButton_q5js toggleButtonDisabled_JZtU" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_p1LU lightToggleIcon_nOnM"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_p1LU darkToggleIcon_WW4N"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_p1LU systemToggleIcon_Rw_L"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_hjbF"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_xEj_"><div class="docsWrapper_RZ8f"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_viJ1" type="button"></button><div class="docRoot_LRAe"><aside class="theme-doc-sidebar-container docSidebarContainer_adD_"><div class="sidebarViewport_rqXg"><div class="sidebar_cWOd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_ZJ4F"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/wealth-vn/docs"><span title="Getting Started" class="categoryLinkLabel_L21k">Getting Started</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/wealth-vn/docs/development/overview"><span title="Development" class="categoryLinkLabel_L21k">Development</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/wealth-vn/docs/development/overview"><span title="Development Overview" class="linkLabel_l67t">Development Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/wealth-vn/docs/development/activities/activity-types"><span title="Activities" class="categoryLinkLabel_L21k">Activities</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/wealth-vn/docs/development/goals/goal-page-logic"><span title="Goals" class="categoryLinkLabel_L21k">Goals</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wealth-vn/docs/development/goals/goal-page-logic"><span title="Goals Logic" class="linkLabel_l67t">Goals Logic</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wealth-vn/docs/development/goals/allocation-setting-plan"><span title="Goal Allocation Setting Plan" class="linkLabel_l67t">Goal Allocation Setting Plan</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/wealth-vn/docs/development/goals/goal-actual-growth-business-logic"><span title="Goal Actual Growth Business Logic" class="linkLabel_l67t">Goal Actual Growth Business Logic</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wealth-vn/docs/development/goals/goal-details-page"><span title="Goal Detail Page" class="linkLabel_l67t">Goal Detail Page</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/wealth-vn/docs/development/goals/projected-value-business-logic"><span title="Projected Value Business Logic" class="linkLabel_l67t">Projected Value Business Logic</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/wealth-vn/docs/development/vn-market/vn-assets-synchronization"><span title="VN Market Integration" class="categoryLinkLabel_L21k">VN Market Integration</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/wealth-vn/docs/development/ui-revamp-implementation"><span title="UI &amp; Design" class="categoryLinkLabel_L21k">UI &amp; Design</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/wealth-vn/docs/development/i18n"><span title="Internationalization" class="categoryLinkLabel_L21k">Internationalization</span></a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/wealth-vn/docs/api/overview"><span title="API Reference" class="categoryLinkLabel_L21k">API Reference</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_l3jO menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/wealth-vn/docs/deployment/web"><span title="Deployment" class="categoryLinkLabel_L21k">Deployment</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_uX8_"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Dcb3"><div class="docItemContainer_U8Ju"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_ouZM" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/wealth-vn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_T_oX"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Goals</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Goal Actual Growth Business Logic</span></li></ul></nav><div class="tocCollapsible_e9k4 theme-doc-toc-mobile tocMobile_V66e"><button type="button" class="clean-btn tocCollapsibleButton_AjWg">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Goal Actual Growth Business Logic</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p>This document describes the complete business logic for calculating goal actual growth. The system tracks how allocated portfolio values grow over time and attributes that growth correctly across multiple accounts and goals.</p>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="core-concepts">Core Concepts<a href="#core-concepts" class="hash-link" aria-label="Direct link to Core Concepts" title="Direct link to Core Concepts" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="1-allocation-model">1. Allocation Model<a href="#1-allocation-model" class="hash-link" aria-label="Direct link to 1. Allocation Model" title="Direct link to 1. Allocation Model" translate="no">​</a></h3>
<p>Each goal has allocations across one or more accounts:</p>
<ul>
<li class=""><strong>initialContribution</strong>: The initial dollar amount allocated (locked at goal start date).</li>
<li class=""><strong>allocatedPercent</strong>: The percentage of account growth attributed to this goal (0-100%)</li>
<li class=""><strong>allocationDate</strong>: When the allocation was made (typically goal.startDate for initial allocations)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="2-growth-attribution-principle">2. Growth Attribution Principle<a href="#2-growth-attribution-principle" class="hash-link" aria-label="Direct link to 2. Growth Attribution Principle" title="Direct link to 2. Growth Attribution Principle" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Goal Growth = Sum of (Account Growth × Allocation Percentage) for all accounts</span><br></span></code></pre></div></div>
<p>Where:</p>
<ul>
<li class=""><strong>Account Growth</strong> = Current Account Value - Account Value at Goal Start Date</li>
<li class=""><strong>Allocation Percentage</strong> = The percentage of account growth attributed to this goal</li>
</ul>
<p>This allows multiple goals to grow from a single account without double-counting.</p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="21-contributed-value">2.1. Contributed Value<a href="#21-contributed-value" class="hash-link" aria-label="Direct link to 2.1. Contributed Value" title="Direct link to 2.1. Contributed Value" translate="no">​</a></h3>
<p>Contributed Value is the total value of the goal at the current date that have contributed to the goal.</p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Contributed Value = Sum of (initialContribution + Account Growth × Allocation Percentage) for all accounts</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="22-goal-growth">2.2. Goal Growth<a href="#22-goal-growth" class="hash-link" aria-label="Direct link to 2.2. Goal Growth" title="Direct link to 2.2. Goal Growth" translate="no">​</a></h3>
<p>Unallocated Value is the value of the account that is not allocated to any goal at the specified date.</p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated Value = Account Value at Goal specified Date - sum (contributed value and initialContribution of all goals at the specified date)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="3-current-value-vs-initial-contribution">3. Current Value vs Initial Contribution<a href="#3-current-value-vs-initial-contribution" class="hash-link" aria-label="Direct link to 3. Current Value vs Initial Contribution" title="Direct link to 3. Current Value vs Initial Contribution" translate="no">​</a></h3>
<p>Under the new allocation system:</p>
<ul>
<li class=""><strong>initialContribution</strong>: The originally allocated amount (locked in at allocation date)</li>
<li class=""><strong>current_value</strong>: initialContribution + attributed_growth</li>
<li class=""><strong>growth</strong>: current_value - initialContribution</li>
</ul>
<p><strong>Important</strong>: All allocations are initialized with initialContribution=0 and allocatedPercent=0 when a goal is created. Users then allocate from the unallocated pool.</p>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="calculation-scenarios">Calculation Scenarios<a href="#calculation-scenarios" class="hash-link" aria-label="Direct link to Calculation Scenarios" title="Direct link to Calculation Scenarios" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="scenario-1-single-account-single-goal">Scenario 1: Single Account, Single Goal<a href="#scenario-1-single-account-single-goal" class="hash-link" aria-label="Direct link to Scenario 1: Single Account, Single Goal" title="Direct link to Scenario 1: Single Account, Single Goal" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value at goal start (2024-01-01) = 0</li>
<li class="">Account A: Current value (today) = 100,000,000</li>
<li class="">Goal created today with startDate=2024-01-01</li>
<li class="">User allocates: initialContribution=0 (can not greater than value at start date), allocatedPercent=50%</li>
</ul>
<p><strong>Calculation:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Account growth = 100,000,000 - 0 = 100,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal growth = 100,000,000 × 50% = 50,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal current value = initialContribution + growth = 0 + 50,000,000 = 50,000,000</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="scenario-2-single-account-multiple-goals">Scenario 2: Single Account, Multiple Goals<a href="#scenario-2-single-account-multiple-goals" class="hash-link" aria-label="Direct link to Scenario 2: Single Account, Multiple Goals" title="Direct link to Scenario 2: Single Account, Multiple Goals" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value at goal start = 0</li>
<li class="">Account A: Current value = 100,000,000</li>
<li class="">Goal 1: initialContribution= 0 (can not greater than value at start date), allocatedPercent=50%</li>
<li class="">Goal 2: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%</li>
<li class="">Unallocated: 20,000,000 @ 20%</li>
<li class="">Unallocated growth = 20,000,000</li>
</ul>
<p><strong>Calculation:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Account growth = 100,000,000 (from 0 - 100M)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal 1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  growth = 100,000,000 × 50% = 50,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  contributedValue = 0 + 50,000,000 = 50,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal 2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  growth = 100,000,000 × 30% = 30,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  contributedValue = 0 + 30,000,000 = 30,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  growth = 100,000,000 × 20% = 20,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  unallocatedValue = 20,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validation: 50M + 30M + 20M = 100M  = Goal Growth (from 0 - 100M)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="scenario-3-multiple-accounts-single-goal">Scenario 3: Multiple Accounts, Single Goal<a href="#scenario-3-multiple-accounts-single-goal" class="hash-link" aria-label="Direct link to Scenario 3: Multiple Accounts, Single Goal" title="Direct link to Scenario 3: Multiple Accounts, Single Goal" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account 1: Value at goal start = 0, Current = 100,000,000</li>
<li class="">Account 2: Value at goal start = 0, Current = 100,000,000</li>
<li class="">Account 3: Value at goal start = 0, Current = 100,000,000</li>
<li class="">Goal 1:<!-- -->
<ul>
<li class="">Account 1: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%</li>
<li class="">Account 2: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%</li>
<li class="">Account 3: initialContribution=0 (can not greater than value at start date), allocatedPercent=30%</li>
</ul>
</li>
</ul>
<p><strong>Calculation:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Account 1 growth = 100,000,000 × 30% = 30,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Account 2 growth = 100,000,000 × 30% = 30,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Account 3 growth = 100,000,000 × 30% = 30,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal 1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  total_growth = 30M + 30M + 30M = 90,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  current = (0 + 0 + 0) + 90M = 90,000,000</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="scenario-4-allocation-edits-amount-change">Scenario 4: Allocation Edits (Amount Change)<a href="#scenario-4-allocation-edits-amount-change" class="hash-link" aria-label="Direct link to Scenario 4: Allocation Edits (Amount Change)" title="Direct link to Scenario 4: Allocation Edits (Amount Change)" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value at goal start = 1,000, Current account value = 1,100</li>
<li class="">Goal allocation: initialContribution=500, allocatedPercent=50%</li>
<li class="">User edits allocation to: initialContribution=600</li>
</ul>
<p><strong>Before Edit:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Growth = (1,100 - 1,000) × 50% = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Contributed Value = 500 + 50 = 550</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated = 1,100 - 550 = 550</span><br></span></code></pre></div></div>
<p><strong>After Edit:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Growth = (1,100 - 1,000) × 50% = 50 (unchanged - still from historical baseline)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Contributed Value = 600 + 50 = 650</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated = 1,100 - 650 = 450</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impact:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Allocation increased by 100. The initialContribution is now 600. but the init point of actual growth line is start at 600 after make change</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Unallocated decreased by 100</span><br></span></code></pre></div></div>
<p><strong>Key</strong>: The historical growth (50) doesn&#x27;t change. Only the initialContribution changes.</p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="scenario-5-allocation-edits-percentage-change">Scenario 5: Allocation Edits (Percentage Change)<a href="#scenario-5-allocation-edits-percentage-change" class="hash-link" aria-label="Direct link to Scenario 5: Allocation Edits (Percentage Change)" title="Direct link to Scenario 5: Allocation Edits (Percentage Change)" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value at goal start = 1,000, Current = 1,100</li>
<li class="">Goal allocation: initialContribution=500, allocatedPercent=50%</li>
<li class="">User edits percentage to: 70%</li>
</ul>
<p><strong>Before Edit:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Growth = (1,100 - 1,000) × 50% = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Contributed Value = 500 + 50 = 550</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated = 1,100 - 550 = 550</span><br></span></code></pre></div></div>
<p><strong>After Edit:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Growth = (1,100 - 1,000) × 70% = 70</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Contributed Value = 500 + 70 = 570</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated = 1,100 - 570 = 530</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Impact:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Growth increases by 20 (from the 20% percentage change)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- InitialContribution stays locked at 500 (no changes)</span><br></span></code></pre></div></div>
<p><strong>Key</strong>: initialContribution is immutable. Only growth recalculates based on new percentage. the growth line will start from the new initialContribution point.</p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="scenario-6-segmented-growth-multiple-allocation-versions">Scenario 6: Segmented Growth (Multiple Allocation Versions)<a href="#scenario-6-segmented-growth-multiple-allocation-versions" class="hash-link" aria-label="Direct link to Scenario 6: Segmented Growth (Multiple Allocation Versions)" title="Direct link to Scenario 6: Segmented Growth (Multiple Allocation Versions)" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value at goal start (Jan 1) = 1,000</li>
<li class="">Value at Feb 15 = 1,100</li>
<li class="">Value at Apr 1 = 1,250</li>
<li class="">Current (today) = 1,330</li>
</ul>
<p><strong>Allocation History:</strong>
Assign Acount A to goal</p>
<ul>
<li class="">initialContribution=0</li>
<li class="">Version 1: Jan 1 - Feb 15, allocatedPercent=50%</li>
<li class="">Version 2: Feb 15 - Apr 1, allocatedPercent=50%</li>
<li class="">Version 3: Apr 1 - today, allocatedPercent=60%</li>
</ul>
<p><strong>Calculation:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Period 1 (Jan 1 - Feb 15):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  goal growth = (1,100 - 1,000) × 50% = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  goal contributedValue = 0 + 50 = 50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Period 2 (Feb 15 - Apr 1):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  goal growth = (1,250 - 1,100) × 50% = 75</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  goal contributedValue = 50 + 75 = 125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Period 3 (Apr 1 - today):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  goal growth = (1,330 - 1,250) × 60% = 48</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  goal contributedValue = 125 + 48 = 173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total goal growth = 50 + 75 + 48 = 173</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Total goal contributedValue = 0 + 173 = 173</span><br></span></code></pre></div></div>
<p>Note: The initialContribution is 0, so the contributed value is the same as the growth. The line in chart only change following the changes of growth.</p>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="edge-cases">Edge Cases<a href="#edge-cases" class="hash-link" aria-label="Direct link to Edge Cases" title="Direct link to Edge Cases" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="case-1-goal-created-after-account-has-grown">Case 1: Goal Created After Account Has Grown<a href="#case-1-goal-created-after-account-has-grown" class="hash-link" aria-label="Direct link to Case 1: Goal Created After Account Has Grown" title="Direct link to Case 1: Goal Created After Account Has Grown" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value on 2024-01-01 = 0</li>
<li class="">Account A: Current (2025-12-14) = 100,000,000</li>
<li class="">Goal created today with startDate=2024-01-01</li>
<li class="">User allocates: initialContribution=0 (account value at start date is 0, not allowed to greater than value at start date), allocatedPercent=50%</li>
</ul>
<p><strong>Result:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated at goal start date (2024-01-01) = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cannot allocate 50,000,000 when unallocated was 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is INVALID. The system should prevent this with validation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;Allocation amount exceeds historical unallocated balance at goal start date&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Correct approach:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- User can only allocate UP TO the current unallocated balance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- OR the system allocates from the grown balance retroactively</span><br></span></code></pre></div></div>
<p><strong>Business Logic Decision:</strong>
According to allocation-setting-plan.md:</p>
<ul>
<li class="">When a goal is created with historical start date, unallocated is calculated at that start date</li>
<li class="">User can only allocate from that historical unallocated balance (plus its subsequent growth)</li>
<li class="">If user wants to allocate 50M today, it must come from the 40M unallocated that grew from 0</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="case-2-account-value-decreases">Case 2: Account Value Decreases<a href="#case-2-account-value-decreases" class="hash-link" aria-label="Direct link to Case 2: Account Value Decreases" title="Direct link to Case 2: Account Value Decreases" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value at goal start = 1,000, Current value = 800</li>
<li class="">Goal allocation: initialContribution=500, allocatedPercent=50%</li>
</ul>
<p><strong>Calculation:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Account growth = 800 - 1,000 = -200 (negative/loss)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal growth = -200 × 50% = -100 (loss proportional to allocation)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Contributed value = 500 + (-100) = 400</span><br></span></code></pre></div></div>
<p><strong>Key</strong>: Losses are attributed proportionally to allocations, just like gains.</p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="case-3-zero-account-value">Case 3: Zero Account Value<a href="#case-3-zero-account-value" class="hash-link" aria-label="Direct link to Case 3: Zero Account Value" title="Direct link to Case 3: Zero Account Value" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value at goal start = 0, Current value = 100,000,000</li>
<li class="">Goal allocation: initialContribution=0, allocatedPercent=50% (default initialization)</li>
</ul>
<p><strong>Calculation:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Account growth = 100,000,000 - 0 = 100,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal growth = 100,000,000 × 50% = 50,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Contributed value = 0 + 50,000,000 = 50,000,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">This is valid and shows correct initialization behavior</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="case-4-account-grows-before-allocation">Case 4: Account Grows Before Allocation<a href="#case-4-account-grows-before-allocation" class="hash-link" aria-label="Direct link to Case 4: Account Grows Before Allocation" title="Direct link to Case 4: Account Grows Before Allocation" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Value on 2024-01-01 = 100,000</li>
<li class="">Account A: Value on 2024-06-01 = 200,000 (grew by 100,000)</li>
<li class="">Account A: Current value = 300,000</li>
</ul>
<p><strong>Scenario A: Allocate on 2024-06-01</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">For the allocation, use:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Goal start date: 2024-01-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Allocation date: 2024-06-01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Account value at goal start: 100,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Account value at allocation: 200,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Current value: 300,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Unallocated at goal start = 100,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User can allocate from current unallocated value (which has grown from 100,000 to 200,000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If user allocates 150,000 on 2024-06-01:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- initialContribution: 150,000 (locked in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- unallocated: 200,000 - 150,000 = 50,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- allocation percentage: manual input (20%)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Growth calculation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- account growth from goal allocation date = 300,000 - 200,000 = 100,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- goal growth = 100,000 × 20% = 20,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- contributedValue = 150,000 + 20,000 = 170,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- unallocated = 50,000 + 100,000* (100% - 20%) = 50,000 + 80,000 = 130,000</span><br></span></code></pre></div></div>
<p><strong>Key</strong>: Allocation percentage is based on account value AT ALLOCATION TIME, not goal start time.</p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="case-5-future-start-goal-goal-not-yet-begun">Case 5: Future-Start Goal (Goal Not Yet Begun)<a href="#case-5-future-start-goal-goal-not-yet-begun" class="hash-link" aria-label="Direct link to Case 5: Future-Start Goal (Goal Not Yet Begun)" title="Direct link to Case 5: Future-Start Goal (Goal Not Yet Begun)" translate="no">​</a></h3>
<p><strong>Setup:</strong></p>
<ul>
<li class="">Account A: Current value (2025-12-14) = 100,000</li>
<li class="">Goal created today with startDate=2025-12-25 (future date, 11 days from now)</li>
<li class="">Unallocated balance today = 100,000</li>
<li class="">User opens goal details and clicks &quot;Edit Allocations&quot;</li>
</ul>
<p><strong>Behavior:</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">For future-start goals:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1. Use CURRENT account values as the baseline for &quot;Unallocated Balance&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Unallocated = Account Current Value - Sum(initialContributions of all goals)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Example: 100,000 - 0 = 100,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. User can allocate from the current unallocated pool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - initialContribution: up to 100,000 (current unallocated)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - allocatedPercent: 0-100% (user configurable)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - allocationDate: NOT set by user, backend backfills from goal.startDate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. When goal start date arrives (2025-12-25):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Backend will use historical account value at 2025-12-25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Growth calculated from that historical baseline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example allocation made today for future-start goal:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- initialContribution: 50,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- allocatedPercent: 40%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- allocationDate: (empty, backend will set to 2025-12-25)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Unallocated remaining: 100,000 - 50,000 = 50,000</span><br></span></code></pre></div></div>
<p><strong>Growth Calculation (after goal start date):</strong></p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Assume on 2025-12-25:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Account value = 102,000 (grew by 2,000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Assume on 2026-01-14 (today + 31 days): Account value = 105,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Goal growth from 2025-12-25 to 2026-01-14:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Account growth = 105,000 - 102,000 = 3,000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Goal growth = 3,000 × 40% = 1,200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- Contributed value = 50,000 + 1,200 = 51,200</span><br></span></code></pre></div></div>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li class="">Allocations created on-demand (when user opens edit modal, not on goal creation)</li>
<li class="">Uses current account values, not future/projected values</li>
<li class="">Backend backfills allocation dates from goal dates</li>
<li class="">Goal creation succeeds immediately (no dependent allocation save)</li>
<li class="">Allocation percentages describe future growth attribution, not current ownership</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="implementation-requirements">Implementation Requirements<a href="#implementation-requirements" class="hash-link" aria-label="Direct link to Implementation Requirements" title="Direct link to Implementation Requirements" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="1-backend-calculation-rust">1. Backend Calculation (Rust)<a href="#1-backend-calculation-rust" class="hash-link" aria-label="Direct link to 1. Backend Calculation (Rust)" title="Direct link to 1. Backend Calculation (Rust)" translate="no">​</a></h3>
<p>The <code>GoalService.calculate_goal_progress_on_date()</code> must:</p>
<div class="language-rust codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-rust codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token class-name">For</span><span class="token plain"> each allocation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token class-name">Get</span><span class="token plain"> account value at goal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">start_date</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">baseline</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token class-name">Get</span><span class="token plain"> account value at </span><span class="token function" style="color:#d73a49">query_date</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">current</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token class-name">Calculate</span><span class="token plain"> account_growth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> baseline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token class-name">Calculate</span><span class="token plain"> allocated_growth </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> account_growth × </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">percentage </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token class-name">Accumulate</span><span class="token plain"> total_growth</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token class-name">Return</span><span class="token plain"> </span><span class="token class-name">GoalProgressSnapshot</span><span class="token plain"> with all details</span><br></span></code></pre></div></div>
<p><strong>Current Implementation Status</strong>: ✓ Implemented correctly in <code>src-core/src/goals/goals_service.rs</code></p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="2-frontend-calculation-react">2. Frontend Calculation (React)<a href="#2-frontend-calculation-react" class="hash-link" aria-label="Direct link to 2. Frontend Calculation (React)" title="Direct link to 2. Frontend Calculation (React)" translate="no">​</a></h3>
<p>The <code>useGoalProgress()</code> hook must:</p>
<div class="language-typescript codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-typescript codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token maybe-class-name">For</span><span class="token plain"> each goal</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">1.</span><span class="token plain"> </span><span class="token maybe-class-name">Find</span><span class="token plain"> all active </span><span class="token function" style="color:#d73a49">allocations</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">where startDate </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> today </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> endDate</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">2.</span><span class="token plain"> </span><span class="token maybe-class-name">For</span><span class="token plain"> each allocation</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token maybe-class-name">Get</span><span class="token plain"> current account value </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> latestValuations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token maybe-class-name">Calculate</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> allocated_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> account_value </span><span class="token function" style="color:#d73a49">×</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">allocation</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">percentage</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">3.</span><span class="token plain"> </span><span class="token maybe-class-name">Sum</span><span class="token plain"> all allocated_values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> currentValue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">4.</span><span class="token plain"> </span><span class="token maybe-class-name">Calculate</span><span class="token plain"> projectedValue using compound interest formula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token number" style="color:#36acaa">5.</span><span class="token plain"> </span><span class="token maybe-class-name">Compare</span><span class="token plain"> currentValue vs projectedValue to determine isOnTrack</span><br></span></code></pre></div></div>
<p><strong>Current Implementation Status</strong>: ⚠️ Incorrect / Divergent</p>
<ul>
<li class="">Uses <code>percentAllocation</code> (should be <code>allocatedPercent</code> as per type definitions)</li>
<li class="">Calculates <code>allocatedValue</code> as <code>totalValue * percentage</code>. This interprets percentage as &quot;% of Total Account Value&quot; rather than &quot;% of Growth or Attribution&quot;</li>
<li class="">Does not subtract historical account value at goal start (no access to historical data in this hook)</li>
<li class="">Assumes <code>startValue</code> is 0 for projections</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="3-modal-display-edit-allocation">3. Modal Display (Edit Allocation)<a href="#3-modal-display-edit-allocation" class="hash-link" aria-label="Direct link to 3. Modal Display (Edit Allocation)" title="Direct link to 3. Modal Display (Edit Allocation)" translate="no">​</a></h3>
<p>The <code>EditAllocationModal</code> must display:</p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">For each account:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Value at goal.startDate (historical baseline for past/current goals)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Unallocated at that date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Current user allocation amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Current allocation percentage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For future-start goals:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Use CURRENT account values as the baseline</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Display &quot;Unallocated&quot; as current unallocated balance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Allocations will have their dates backfilled by backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Validation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Sum of allocations &lt;= unallocated balance (at goal start for past goals, current for future goals)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Amount delta fits within available unallocated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - Percentage sum &lt;= 100% per account</span><br></span></code></pre></div></div>
<p><strong>Current Implementation Status</strong>: ✓ Checks against Current Value</p>
<ul>
<li class="">Modal receives <code>currentAccountValues</code></li>
<li class="">Validates that <code>initialContribution &lt;= currentAccountValue - sum(other_allocations_init_contributions)</code></li>
<li class="">For future-start goals: detects future dates and uses current values instead of trying to fetch non-existent historical data</li>
<li class="">Creates allocations on-demand in submit handler (no default allocations created on goal creation)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="4-data-models">4. Data Models<a href="#4-data-models" class="hash-link" aria-label="Direct link to 4. Data Models" title="Direct link to 4. Data Models" translate="no">​</a></h3>
<p>Required fields on <code>GoalAllocation</code>:</p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">- id: string (unique per goal-account pair)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- goalId: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- accountId: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- initialContribution: number (the init_amount, locked)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- allocatedPercent: number (0-100, the growth attribution %)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- allocationDate: string (when allocated, typically goal.startDate)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- initAmount: f64 (same as initialContribution, for clarity)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- startDate: string (goal.startDate, when this allocation begins)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- endDate: string (goal.dueDate, when this allocation ends)</span><br></span></code></pre></div></div>
<p><strong>Current Implementation Status</strong>: ✓ Types match <code>src/lib/types.ts</code> (<code>allocatedPercent</code>), but frontend usage in <code>useGoalProgress</code> is inconsistent (uses <code>percentAllocation</code>).</p>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="growth-line-chart-calculation">Growth Line Chart Calculation<a href="#growth-line-chart-calculation" class="hash-link" aria-label="Direct link to Growth Line Chart Calculation" title="Direct link to Growth Line Chart Calculation" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="actual-growth-line">Actual Growth Line<a href="#actual-growth-line" class="hash-link" aria-label="Direct link to Actual Growth Line" title="Direct link to Actual Growth Line" translate="no">​</a></h3>
<p>For each date in chart:</p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">1. Get account values at that date (historical)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. For each allocation:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Lookup allocation version active on that date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - Calculate: growth = (account_value_at_date - account_value_at_goal_start) × percentage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3. Sum all growth = actual_value at that date</span><br></span></code></pre></div></div>
<p><strong>Key</strong>: Use historical account valuations, not current values.</p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="projected-growth-line">Projected Growth Line<a href="#projected-growth-line" class="hash-link" aria-label="Direct link to Projected Growth Line" title="Direct link to Projected Growth Line" translate="no">​</a></h3>
<p>For each date in chart:</p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">1. Calculate months from goal start to that date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2. Use compound interest formula:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   FV = PMT × [((1 + r)^n - 1) / r]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Where:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - PMT = monthly_investment from goal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - r = annual_return_rate / 12 / 100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   - n = months_from_start</span><br></span></code></pre></div></div>
<p><strong>Current Implementation Status</strong>: ✓ Implemented in <code>src/pages/goals/use-goal-valuation-history.ts</code></p>
<ul>
<li class="">Fetches historical valuations correctly</li>
<li class="">Calculates actuals attempting to follow: <code>initialContribution + (current - start) * percent</code></li>
<li class=""><strong>Note</strong>: Projection calculation currently ignores the <code>startValue</code> (Initial Allocation), projecting only monthly contributions.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="validation-rules">Validation Rules<a href="#validation-rules" class="hash-link" aria-label="Direct link to Validation Rules" title="Direct link to Validation Rules" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="1-allocation-constraints">1. Allocation Constraints<a href="#1-allocation-constraints" class="hash-link" aria-label="Direct link to 1. Allocation Constraints" title="Direct link to 1. Allocation Constraints" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">For each account on any date:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Sum(initialContributions for active allocations) &lt;= account_value_at_that_date</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="2-percentage-constraints">2. Percentage Constraints<a href="#2-percentage-constraints" class="hash-link" aria-label="Direct link to 2. Percentage Constraints" title="Direct link to 2. Percentage Constraints" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">For each account on any date:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Sum(allocatedPercents for active allocations) &lt;= 100%</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="3-unallocated-balance">3. Unallocated Balance<a href="#3-unallocated-balance" class="hash-link" aria-label="Direct link to 3. Unallocated Balance" title="Direct link to 3. Unallocated Balance" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">unallocated_value = account_current_value - sum(initialContributions)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unallocated_value must be &gt;= 0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="4-retroactive-allocation">4. Retroactive Allocation<a href="#4-retroactive-allocation" class="hash-link" aria-label="Direct link to 4. Retroactive Allocation" title="Direct link to 4. Retroactive Allocation" translate="no">​</a></h3>
<p>When allocating to a goal with historical start date:</p>
<div class="language-text codeBlockContainer_MKBk theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_7Ypw"><pre tabindex="0" class="prism-code language-text codeBlock_Dl0Y thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_nSJr"><span class="token-line" style="color:#393A34"><span class="token plain">Check at goal start date:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  requested_allocation &lt;= unallocated_at_goal_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If violated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Error: &quot;Cannot allocate more than available at goal start date (YYYY-MM-DD)&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="allocation-creation-strategy">Allocation Creation Strategy<a href="#allocation-creation-strategy" class="hash-link" aria-label="Direct link to Allocation Creation Strategy" title="Direct link to Allocation Creation Strategy" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="on-demand-creation-not-upfront">On-Demand Creation (Not Upfront)<a href="#on-demand-creation-not-upfront" class="hash-link" aria-label="Direct link to On-Demand Creation (Not Upfront)" title="Direct link to On-Demand Creation (Not Upfront)" translate="no">​</a></h3>
<p><strong>Why allocations are created on-demand (when user opens edit modal) rather than upfront (on goal creation):</strong></p>
<ol>
<li class="">
<p><strong>Goal Creation Success</strong>: Creating allocations upfront couples goal creation to allocation initialization, which can fail. By creating on-demand, goal creation always succeeds.</p>
</li>
<li class="">
<p><strong>Future-Start Goals</strong>: Future-start goals have no historical baseline, making upfront allocation validation complex. On-demand creation lets users adjust allocations after goal creation with full context.</p>
</li>
<li class="">
<p><strong>Simpler Error Handling</strong>: If allocation save fails, it happens in the context where the user is actively managing allocations (edit modal), not hidden in goal creation flow.</p>
</li>
<li class="">
<p><strong>Flexibility</strong>: Users can create a goal first, then decide allocation strategy later, even for future-start goals.</p>
</li>
</ol>
<p><strong>Implementation:</strong></p>
<ul>
<li class="">Goal creation does NOT call <code>saveAllocationsMutation</code></li>
<li class=""><code>EditAllocationModal</code> creates allocations on first save if they don&#x27;t exist (checked via <code>existingAllocations</code>)</li>
<li class="">Both update and create flows use same save path: <code>updatedAllocations.push({...})</code></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="configuration--flexibility">Configuration &amp; Flexibility<a href="#configuration--flexibility" class="hash-link" aria-label="Direct link to Configuration &amp; Flexibility" title="Direct link to Configuration &amp; Flexibility" translate="no">​</a></h2>
<p>The actual growth line becomes configurable through:</p>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="1-allocation-amount-changes">1. Allocation Amount Changes<a href="#1-allocation-amount-changes" class="hash-link" aria-label="Direct link to 1. Allocation Amount Changes" title="Direct link to 1. Allocation Amount Changes" translate="no">​</a></h3>
<ul>
<li class="">User edits the initialContribution</li>
<li class="">Growth recalculates automatically</li>
<li class="">Unallocated pool adjusts by the delta</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="2-allocation-percentage-changes">2. Allocation Percentage Changes<a href="#2-allocation-percentage-changes" class="hash-link" aria-label="Direct link to 2. Allocation Percentage Changes" title="Direct link to 2. Allocation Percentage Changes" translate="no">​</a></h3>
<ul>
<li class="">User edits the growth attribution percentage</li>
<li class="">Only future/historical growth recalculates</li>
<li class="">initialContribution remains locked</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="3-allocation-history">3. Allocation History<a href="#3-allocation-history" class="hash-link" aria-label="Direct link to 3. Allocation History" title="Direct link to 3. Allocation History" translate="no">​</a></h3>
<ul>
<li class="">Each edit creates a new version</li>
<li class="">Growth segments by time period</li>
<li class="">Total growth = sum of all period gains</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="4-account-selection">4. Account Selection<a href="#4-account-selection" class="hash-link" aria-label="Direct link to 4. Account Selection" title="Direct link to 4. Account Selection" translate="no">​</a></h3>
<ul>
<li class="">User can allocate from different accounts</li>
<li class="">Each account&#x27;s growth is tracked independently</li>
<li class="">Multi-account goals show per-account breakdown</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="testing-scenarios">Testing Scenarios<a href="#testing-scenarios" class="hash-link" aria-label="Direct link to Testing Scenarios" title="Direct link to Testing Scenarios" translate="no">​</a></h2>
<p>All scenarios from &quot;Calculation Scenarios&quot; section should have tests covering:</p>
<ol>
<li class="">✓ Single account, single goal</li>
<li class="">✓ Single account, multiple goals</li>
<li class="">✓ Multiple accounts, single goal</li>
<li class="">✓ Allocation amount edits</li>
<li class="">✓ Allocation percentage edits</li>
<li class="">✓ Segmented growth (version history)</li>
<li class="">✓ Negative growth (losses)</li>
<li class="">✓ Zero baseline values</li>
<li class="">✓ Retroactive allocation to historical start date</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="issues--known-gaps">Issues &amp; Known Gaps<a href="#issues--known-gaps" class="hash-link" aria-label="Direct link to Issues &amp; Known Gaps" title="Direct link to Issues &amp; Known Gaps" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="1-react-hook-logic-errors-usegoalprogress">1. React Hook Logic Errors (<code>useGoalProgress</code>)<a href="#1-react-hook-logic-errors-usegoalprogress" class="hash-link" aria-label="Direct link to 1-react-hook-logic-errors-usegoalprogress" title="Direct link to 1-react-hook-logic-errors-usegoalprogress" translate="no">​</a></h3>
<ul>
<li class="">Uses incorrect field <code>percentAllocation</code> (instead of <code>allocatedPercent</code>), which likely results in <code>undefined</code> values at runtime.</li>
<li class="">Implements <code>Total Value * Percentage</code> logic instead of <code>Init + (Growth * Percentage)</code>, conflating &quot;Ownership of Account&quot; with &quot;Attribution of Growth&quot;.</li>
<li class="">Does not fetch historical data to establish baseline.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="2-projection-logic-gaps">2. Projection Logic Gaps<a href="#2-projection-logic-gaps" class="hash-link" aria-label="Direct link to 2. Projection Logic Gaps" title="Direct link to 2. Projection Logic Gaps" translate="no">​</a></h3>
<ul>
<li class=""><code>calculateProjectedValue</code> (in both <code>useGoalProgress</code> and <code>useGoalValuationHistory</code>) ignores the <code>startValue</code> / <code>initialContribution</code>. It projects growth ONLY on monthly contributions, effectively assuming 0 starting capital for the projection curve.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="3-modal-validation-logic">3. Modal Validation logic<a href="#3-modal-validation-logic" class="hash-link" aria-label="Direct link to 3. Modal Validation logic" title="Direct link to 3. Modal Validation logic" translate="no">​</a></h3>
<ul>
<li class="">✓ FIXED: <code>EditAllocationModal</code> now correctly handles both past-start and future-start goals</li>
<li class="">For future-start goals: detects future dates and uses current account values as baseline (not non-existent historical data)</li>
<li class="">For past-start goals: uses historical account values at goal.startDate when available</li>
<li class="">Subtracts <code>sum(initialContributions)</code> from baseline to find &quot;Available&quot;, which is appropriate for both scenarios</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="4-historical-data-fallbacks">4. Historical Data Fallbacks<a href="#4-historical-data-fallbacks" class="hash-link" aria-label="Direct link to 4. Historical Data Fallbacks" title="Direct link to 4. Historical Data Fallbacks" translate="no">​</a></h3>
<ul>
<li class=""><code>useGoalValuationHistory</code> defaults <code>startDateValue</code> to <code>initialContribution</code> if strict historical data for the start date is missing. This is a reasonable fallback but relies on <code>initialContribution</code> being accurate.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_BjIu" id="5-field-naming-consistency">5. Field Naming Consistency<a href="#5-field-naming-consistency" class="hash-link" aria-label="Direct link to 5. Field Naming Consistency" title="Direct link to 5. Field Naming Consistency" translate="no">​</a></h3>
<ul>
<li class=""><code>GoalAllocation</code> interface is correct (<code>allocatedPercent</code>), but usage in some hooks (<code>useGoalProgress</code>) is incorrect.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_BjIu" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ul>
<li class=""><code>docs/.temporary/allocation-setting-plan.md</code> - Allocation model design</li>
<li class=""><code>src-core/src/goals/goals_service.rs</code> - Core growth calculation logic</li>
<li class=""><code>src-core/src/goals/goal_progress_model.rs</code> - Data models</li>
<li class=""><code>src/pages/goals/use-goal-progress.ts</code> - Frontend progress calculation</li>
<li class=""><code>src/pages/goals/use-goal-valuation-history.ts</code> - Chart data generation</li>
<li class=""><code>src/pages/goals/components/edit-allocation-modal.tsx</code> - UI for allocation editing</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_dOC_"><a href="https://github.com/chipheo00/vn-wealthfolio/tree/main/docs/docs/development/goals/goal-actual-growth-business-logic.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_TEaT" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_QwUn"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/wealth-vn/docs/development/goals/allocation-setting-plan"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Goal Allocation Setting Plan</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/wealth-vn/docs/development/goals/goal-details-page"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Goal Detail Page</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_sgE_ thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#core-concepts" class="table-of-contents__link toc-highlight">Core Concepts</a><ul><li><a href="#1-allocation-model" class="table-of-contents__link toc-highlight">1. Allocation Model</a></li><li><a href="#2-growth-attribution-principle" class="table-of-contents__link toc-highlight">2. Growth Attribution Principle</a></li><li><a href="#21-contributed-value" class="table-of-contents__link toc-highlight">2.1. Contributed Value</a></li><li><a href="#22-goal-growth" class="table-of-contents__link toc-highlight">2.2. Goal Growth</a></li><li><a href="#3-current-value-vs-initial-contribution" class="table-of-contents__link toc-highlight">3. Current Value vs Initial Contribution</a></li></ul></li><li><a href="#calculation-scenarios" class="table-of-contents__link toc-highlight">Calculation Scenarios</a><ul><li><a href="#scenario-1-single-account-single-goal" class="table-of-contents__link toc-highlight">Scenario 1: Single Account, Single Goal</a></li><li><a href="#scenario-2-single-account-multiple-goals" class="table-of-contents__link toc-highlight">Scenario 2: Single Account, Multiple Goals</a></li><li><a href="#scenario-3-multiple-accounts-single-goal" class="table-of-contents__link toc-highlight">Scenario 3: Multiple Accounts, Single Goal</a></li><li><a href="#scenario-4-allocation-edits-amount-change" class="table-of-contents__link toc-highlight">Scenario 4: Allocation Edits (Amount Change)</a></li><li><a href="#scenario-5-allocation-edits-percentage-change" class="table-of-contents__link toc-highlight">Scenario 5: Allocation Edits (Percentage Change)</a></li><li><a href="#scenario-6-segmented-growth-multiple-allocation-versions" class="table-of-contents__link toc-highlight">Scenario 6: Segmented Growth (Multiple Allocation Versions)</a></li></ul></li><li><a href="#edge-cases" class="table-of-contents__link toc-highlight">Edge Cases</a><ul><li><a href="#case-1-goal-created-after-account-has-grown" class="table-of-contents__link toc-highlight">Case 1: Goal Created After Account Has Grown</a></li><li><a href="#case-2-account-value-decreases" class="table-of-contents__link toc-highlight">Case 2: Account Value Decreases</a></li><li><a href="#case-3-zero-account-value" class="table-of-contents__link toc-highlight">Case 3: Zero Account Value</a></li><li><a href="#case-4-account-grows-before-allocation" class="table-of-contents__link toc-highlight">Case 4: Account Grows Before Allocation</a></li><li><a href="#case-5-future-start-goal-goal-not-yet-begun" class="table-of-contents__link toc-highlight">Case 5: Future-Start Goal (Goal Not Yet Begun)</a></li></ul></li><li><a href="#implementation-requirements" class="table-of-contents__link toc-highlight">Implementation Requirements</a><ul><li><a href="#1-backend-calculation-rust" class="table-of-contents__link toc-highlight">1. Backend Calculation (Rust)</a></li><li><a href="#2-frontend-calculation-react" class="table-of-contents__link toc-highlight">2. Frontend Calculation (React)</a></li><li><a href="#3-modal-display-edit-allocation" class="table-of-contents__link toc-highlight">3. Modal Display (Edit Allocation)</a></li><li><a href="#4-data-models" class="table-of-contents__link toc-highlight">4. Data Models</a></li></ul></li><li><a href="#growth-line-chart-calculation" class="table-of-contents__link toc-highlight">Growth Line Chart Calculation</a><ul><li><a href="#actual-growth-line" class="table-of-contents__link toc-highlight">Actual Growth Line</a></li><li><a href="#projected-growth-line" class="table-of-contents__link toc-highlight">Projected Growth Line</a></li></ul></li><li><a href="#validation-rules" class="table-of-contents__link toc-highlight">Validation Rules</a><ul><li><a href="#1-allocation-constraints" class="table-of-contents__link toc-highlight">1. Allocation Constraints</a></li><li><a href="#2-percentage-constraints" class="table-of-contents__link toc-highlight">2. Percentage Constraints</a></li><li><a href="#3-unallocated-balance" class="table-of-contents__link toc-highlight">3. Unallocated Balance</a></li><li><a href="#4-retroactive-allocation" class="table-of-contents__link toc-highlight">4. Retroactive Allocation</a></li></ul></li><li><a href="#allocation-creation-strategy" class="table-of-contents__link toc-highlight">Allocation Creation Strategy</a><ul><li><a href="#on-demand-creation-not-upfront" class="table-of-contents__link toc-highlight">On-Demand Creation (Not Upfront)</a></li></ul></li><li><a href="#configuration--flexibility" class="table-of-contents__link toc-highlight">Configuration &amp; Flexibility</a><ul><li><a href="#1-allocation-amount-changes" class="table-of-contents__link toc-highlight">1. Allocation Amount Changes</a></li><li><a href="#2-allocation-percentage-changes" class="table-of-contents__link toc-highlight">2. Allocation Percentage Changes</a></li><li><a href="#3-allocation-history" class="table-of-contents__link toc-highlight">3. Allocation History</a></li><li><a href="#4-account-selection" class="table-of-contents__link toc-highlight">4. Account Selection</a></li></ul></li><li><a href="#testing-scenarios" class="table-of-contents__link toc-highlight">Testing Scenarios</a></li><li><a href="#issues--known-gaps" class="table-of-contents__link toc-highlight">Issues &amp; Known Gaps</a><ul><li><a href="#1-react-hook-logic-errors-usegoalprogress" class="table-of-contents__link toc-highlight">1. React Hook Logic Errors (<code>useGoalProgress</code>)</a></li><li><a href="#2-projection-logic-gaps" class="table-of-contents__link toc-highlight">2. Projection Logic Gaps</a></li><li><a href="#3-modal-validation-logic" class="table-of-contents__link toc-highlight">3. Modal Validation logic</a></li><li><a href="#4-historical-data-fallbacks" class="table-of-contents__link toc-highlight">4. Historical Data Fallbacks</a></li><li><a href="#5-field-naming-consistency" class="table-of-contents__link toc-highlight">5. Field Naming Consistency</a></li></ul></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/wealth-vn/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/wealth-vn/development/overview">Development</a></li><li class="footer__item"><a class="footer__link-item" href="/wealth-vn/api/overview">API Reference</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/chipheo00/vn-wealthfolio" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Repository<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_qkBQ"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/chipheo00/vn-wealthfolio/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues &amp; Discussions<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_qkBQ"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 WealthVN. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>